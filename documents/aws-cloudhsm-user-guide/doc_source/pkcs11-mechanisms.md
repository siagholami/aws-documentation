# Supported PKCS \#11 Mechanisms<a name="pkcs11-mechanisms"></a>

The AWS CloudHSM software library for PKCS \#11 supports the following algorithms:
+ **Encryption and decryption** – AES\-CBC, AES\-CTR, AES\-ECB, AES\-GCM, DES3\-CBC, DES3\-ECB, RSA\-OAEP, and RSA\-PKCS
+ **Sign and verify** – RSA, HMAC, and ECDSA; with and without hashing
+ **Hash/digest** – SHA1, SHA224, SHA256, SHA384, and SHA512
+ **Key wrap** – AES Key Wrap,4 AES\-GCM, RSA\-AES, and RSA\-OAEP
+ **Key derivation** – ECDH5

The AWS CloudHSM software library for PKCS \#11 is compliant with PKCS \#11 version 2\.40\. To invoke a cryptographic feature using PKCS\#11, call a function with a given mechanism\. The following table summarizes the combinations of functions and mechanisms supported by AWS CloudHSM\.

**Interpreting the Supported PKCS \#11 Mechanism\-Function Table**  
A ✔ mark indicates that CloudHSM supports the mechanism for the function\. We do not support all possible functions listed in the PKCS \#11 specification\. A ✖ mark indicates that CloudHSM does not yet support the mechanism for the given function, even though the PKCS \#11 standard allows it\. Empty cells indicate that PKCS \#11 standard does not support the mechanism for the given function\.


**Supported PKCS \#11 Mechanisms and Functions**  
[\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/cloudhsm/latest/userguide/pkcs11-mechanisms.html)

**Annotations**:

1 Single\-part operations only\.

2 Mechanism is functionally identical to the `CKM_RSA_PKCS_KEY_PAIR_GEN` mechanism, but offers stronger guarantees for `p` and `q` generation\.

3\.1 When hashing data using any of the following mechanisms, data buffer less than 16 KB in size is hashed on the HSM\. Larger data buffer, which is between 16 KB and the maximum data size, is hashed locally in software\. The following table lists the maximum data size set for each mechanism:

[\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/cloudhsm/latest/userguide/pkcs11-mechanisms.html)

3\.2 When operating on data by using any of the following mechanisms, if the data buffer exceeds the maximum data size, the operation results in an error\. The following table lists maximum data size set for each mechanism:

[\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/cloudhsm/latest/userguide/pkcs11-mechanisms.html)

4 When performing AES\-GCM encryption, the HSM does not accept initialization vector \(IV\) data from the application\. You must use an IV that it generates\. The 12\-byte IV provided by the HSM is written into the memory reference pointed to by the pIV element of the `CK_GCM_PARAMS` parameters structure that you supply\. To prevent user confusion, PKCS \#11 SDK in version 1\.1\.1 and later ensures that pIV points to a zeroized buffer when AES\-GCM encryption is initialized\.

5 Mechanism is implemented to support SSL/TLS offload cases and is executed only partially within the HSM\. Before using this mechanism, see "Issue: ECDH key derivation is executed only partially within the HSM" in [Known Issues for the PKCS \#11 SDK](KnownIssues.md#ki-pkcs11-sdk)\.

6 The following `CK_MECHANISM_TYPE` and `CK_RSA_PKCS_MGF_TYPE` are supported as `CK_RSA_PKCS_OAEP_PARAMS` for `CKM_RSA_PKCS_OAEP`:
+ `CKM_SHA_1` using `CKG_MGF1_SHA1`
+ `CKM_SHA224` using `CKG_MGF1_SHA224`
+ `CKM_SHA256` using `CKG_MGF1_SHA256`
+ `CKM_SHA384` using `CKM_MGF1_SHA384`
+ `CKM_SHA512` using `CKM_MGF1_SHA512`

7 Vendor\-defined mechanism\. In order to use the CloudHSM vendor defined mechanisms, PKCS\#11 applications must include `/opt/cloudhsm/include/pkcs11t.h` during compilation\. For more information about vendor\-defined mechanism, see the following description:

`CKM_CLOUDHSM_AES_GCM`: This proprietary mechanism is a programmatically safer alternative to the standard `CKM_AES_GCM`\. It prepends the IV generated by the HSM to the ciphertext instead of writing it back into the `CK_GCM_PARAMS` structure that is provided during cipher initialization\. You can use this mechanism with `C_Encrypt`, `C_WrapKey`, `C_Decrypt`, and `C_UnwrapKey` functions\. When using this mechanism, the pIV variable in the `CK_GCM_PARAMS` struct must be set to `NULL`\. When using this mechanism with `C_Decrypt` and `C_UnwrapKey`, the IV is expected to be prepended to the ciphertext that is being unwrapped\.