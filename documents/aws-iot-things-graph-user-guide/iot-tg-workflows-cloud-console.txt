

Create and Deploy a Flow (AWS IoT Things Graph console)

Sign in to the AWS IoT Things Graph console.

Choose Create flow.


Name the flow.

In the Flow configuration pane, enter a name for your flow. This name can't contain any spaces.
Choose Create flow.

Add the trigger and devices to the flow.

On the Logic tab, choose Clock, and then drag it into the flow designer. 
Search for DeviceA, which is a barcode reader that you created in Creating and Uploading Models. Select the device and drag it into the flow designer. Do the same for DeviceB.


Connect the devices.

In the flow designer, select the edge of ClockTrigger and connect it to DeviceA. Connect DeviceA and DeviceB in the same way.

The event appears between the two devices because DeviceA passes an output (the bar code) to DeviceB. You can pass this output to multiple devices and services by connecting this event to them, as in the following image.

This is the correct way to pass output to multiple entities. Directly connecting one device or service to multiple devices or services causes a syntax error when you try to publish the flow.

Update the ClockTrigger.

In the trigger editor that appears in the right pane, for Frequency, enter 10, and then select seconds from the menu on the right. For Action, choose ThingsGraph.startFlow. 

Update the device action for DeviceA.

In the flow designer, select DeviceB. Select No action configured in the action editor that appears in the right pane. Select readBarcode from the drop-down box that appears. Select the arrow that appears to the left of the Output option. Enter deviceAResult in the text box that appears under Output.
Click the surface of the flow designer to close the action editor.

Update the device action for DeviceB.

In the flow designer, select DeviceB. Select No action configured in the action editor that appears in the right pane. Select doSomething from the drop-down box that appears. Select Define Input under the Inputs option. Enter ${deviceAResult} in the pop-up box that appears. Select the Save Input button
Click the surface of the flow designer to close the action editor.

Publish the flow.

Choose Publish at the upper right of the page. This creates the flow and adds it to the list of flows that can be deployed. Then choose Go to flow list to verify that your flow is created.


Start creating the flow configuration.
On the Flows list page, select the check box next to the flow that you just created, and then choose Create flow configuration.



Name the flow configuration.


On the Describe flow configuration page, select your flow and enter a deployment name. The deployment name can't contain spaces. Choose Cloud, and then choose Next.

Configure the target.

On the Configure target page, enter the ARN of the role that you created in Prepare for Cloud Deployments. Choose Next.


Select things.

On the Map Things page, from the menu under deviceA, select the thing that you associated with this device in Creating and Uploading Models. Do the same for deviceB. Choose Next.


View the trigger.

On the Set up triggers page, the following GraphQL appears in the editor. This GraphQL specifies the time intervals at which the flow runs. This flow runs every 10 seconds. You don't need to edit this code.
Choose Review.


Review and create

On the Review and create page, review the information you entered for your flow configuration.
Choose Create.

Deploy

When the Flow configuration created message appears, choose Deploy now.
After a successful deployment, the Deployments page displays Deployed in target in the Status column.