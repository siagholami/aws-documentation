# Web server metrics capture in IIS on Windows server<a name="health-enhanced-metrics-server-iis"></a>

On the Windows Server platform, Elastic Beanstalk adds a module to the IIS web server's request pipeline and captures metrics about HTTP request times and response codes\. The module sends these metrics to the on\-instance health agent using a high\-performance interprocess communication \(IPC\) channel\. The health agent aggregates these metrics, combines them with operating system metrics, and sends them to the Elastic Beanstalk service\.

## Implementation details<a name="health-enhanced-metrics-server-iis.impl"></a>

To capture metrics from IIS, Elastic Beanstalk implements a managed [https://msdn.microsoft.com/en-us/library/system.web.ihttpmodule%28v=vs.110%29.aspx](https://msdn.microsoft.com/en-us/library/system.web.ihttpmodule%28v=vs.110%29.aspx), and subscribes to the [https://msdn.microsoft.com/en-us/library/system.web.httpapplication.beginrequest(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.beginrequest(v=vs.110).aspx) and [https://msdn.microsoft.com/en-us/library/system.web.httpapplication.endrequest(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.endrequest(v=vs.110).aspx) events\. This enables the module to report HTTP request latency and response codes for all web requests handled by IIS\. To add the module to the IIS request pipeline, Elastic Beanstalk registers the module in the [https://docs.microsoft.com/en-us/iis/configuration/system.webserver/modules/](https://docs.microsoft.com/en-us/iis/configuration/system.webserver/modules/) section of the IIS configuration file, `%windir%\System32\inetsrv\config\applicationHost.config`\.

The Elastic Beanstalk module in IIS sends the captured web request metrics to the on\-instance health agent, which is a Windows service named `HealthD`\. To send this data, the module uses [https://msdn.microsoft.com/en-us/library/system.servicemodel.netnamedpipebinding(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.servicemodel.netnamedpipebinding(v=vs.110).aspx), which provides a secure and reliable binding that is optimized for on\-machine communication\.