Tutorial: Setting Up Active Directory
To use Active Directory with AppStream 2.0, you must first register your directory configuration by creating a Directory Config object in AppStream 2.0. This object includes the information required to join streaming instances to an Active Directory domain. You create a Directory Config object by using the AppStream 2.0 management console, AWS SDK, or AWS CLI. You can then use your directory configuration to launch domain-joined fleets and image builders. 
Topics
 Step 1: Create a Directory Config Object
 Step 2: Create an Image by Using a Domain-Joined Image Builder
 Step 3: Create a Domain-Joined Fleet
 Step 4: Configure SAML 2.0
Step 1: Create a Directory Config Object
The Directory Config object that you create in AppStream 2.0 will be used in later steps.
If you are using the AWS SDK, you can use the CreateDirectoryConfig operation. If you are using the AWS CLI, you can use the create-directory-config command.
To create a Directory Config object by using the AppStream 2.0 console


Open the AppStream 2.0 console at https://console.aws.amazon.com/appstream2.


In the navigation pane, choose Directory Configs, Create Directory Config.


For Directory Name, provide the fully qualified domain name (FQDN) of the Active Directory domain (for example, corp.example.com). Each region can have only one Directory Config value with a specific directory name.


For Service Account Name, enter the name of an account that can create computer objects and that has permissions to join the domain. For more information, see Granting Permissions to Create and Manage Active Directory Computer Objects. The account name must be in the format DOMAIN\username.


For Password and Confirm Password, type the directory password for the specified account.


For Organizational Unit (OU), type the distinguished name of at least one OU for streaming instance computer objects. The default Computers container is not an OU and cannot be used by AppStream 2.0. For more information, see Finding the Organizational Unit Distinguished Name.


To add more than one OU, select the plus sign () next to Organizational Unit (OU). To remove OUs, choose the x icon.


Choose Next.


Review the configuration information and choose Create.


Step 2: Create an Image by Using a Domain-Joined Image Builder
Next, using the AppStream 2.0 image builder, create a new image with Active Directory domain-join capabilities. Note that the fleet and image can be members of different domains. You join the image builder to a domain to enable domain join and to install applications. Fleet domain join is discussed in the next section.
To create an image for launching domain-joined fleets


Follow the procedures in Tutorial: Create a Custom AppStream 2.0 Image by Using the AppStream 2.0 Console.


For the base image selection step, use an AWS base image released on or after July 24, 2017. For a current list of released AWS images, see AppStream 2.0 Base Image Version History.


For Step 3: Configure Network, select a VPC and subnets with network connectivity to your Active Directory environment. Select the security groups that are set up to allow access to your directory through your VPC subnets.


Also in Step 3: Configure Network, expand the Active Directory Domain (Optional) section, and select values for the Directory Name and Directory OU to which the image builder should be joined.


Review the image builder configuration and choose Create.


Wait for the new image builder to reach a Running state, and choose Connect.


Log in to the image builder in Administrator mode or as a directory user with local administrator permissions. For more information, see Granting Local Administrator Rights on Image Builders.


Complete the steps in Tutorial: Create a Custom AppStream 2.0 Image by Using the AppStream 2.0 Console to install applications and create a new image.


Step 3: Create a Domain-Joined Fleet
Using the private image created in the previous step, create an Active Directory domain-joined fleet for streaming applications. The domain can be different than the one that you used for the image builder to create the image.
To create a domain-joined fleet


Follow the procedures in Create a Fleet.


For the image selection step, use the image that was created in the previous step, Step 2: Create an Image by Using a Domain-Joined Image Builder.


For Step 4: Configure Network, select a VPC and subnets with network connectivity to your Active Directory environment. Select the security groups that are set up to allow communication to your domain.


Also in Step 4: Configure Network, expand the Active Directory Domain (Optional) section and select the values for the Directory Name and Directory OU to which the fleet should be joined.


Review the fleet configuration and choose Create.


Complete the remaining steps in Create an AppStream 2.0 Fleet and Stack so that your fleet is associated with a stack and running.


Step 4: Configure SAML 2.0
Your users must use your SAML 2.0-based identity federation environment to launch streaming sessions from your domain-joined fleet.
To configure SAML 2.0 for single sign-on access


Follow the procedures in Setting Up SAML.


AppStream 2.0 requires that the SAML_Subject NameID value for the user who is logging in be provided in either of the following formats:
    domain\username using the sAMAccountName
    username@domain.com using the userPrincipalName


If you are using the sAMAccountName format, you can specify the domain by using either the NetBIOS name or the fully qualified domain name (FQDN).


Provide access to your Active Directory users or groups to enable access to the AppStream 2.0 stack from your identity provider application portal.


Complete the remaining steps in Setting Up SAML.


To log in a user with SAML 2.0


Log in to your SAML 2.0 provider's application catalog and open the AppStream 2.0 SAML application that you created in the previous procedure.


When the AppStream 2.0 application catalog is displayed, select an application to launch.


When a loading icon is displayed, you are prompted to provide a password. The domain user name provided by your SAML 2.0 identity provider appears above the password field. Enter your password, and choose log in.


The streaming instance performs the Windows login procedure, and the selected application opens.