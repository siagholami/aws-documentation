Set up basic request validation in API Gateway
You can set up request validators in an API's OpenAPI definition file and then import the OpenAPI definitions into API Gateway. You can also set them up in the API Gateway console or by calling the API Gateway REST API, the AWS CLI, or one of the AWS SDKs. Here, we show how to do this with an OpenAPI file, in the console, and using the API Gateway REST API. 
Topics
 Set up basic request validation by importing OpenAPI definition
 Set up request validators using the API Gateway REST API
 Set up basic request validation using the API Gateway console
Set up basic request validation by importing OpenAPI definition
The following steps describe how to enable basic request validation by importing an OpenAPI file.
To enable request validation by importing an OpenAPI file into API Gateway

Declare request validators in OpenAPI by specifying a set of the x-amazon-apigateway-request-validators.requestValidator object objects in the x-amazon-apigateway-request-validators object map at the API level. For example, the sample API OpenAPI file contains the x-amazon-apigateway-request-validators map, with the validators' names as the keys. 


[ OpenAPI 3.0 ]
{
      "openapi": "3.0.0",
      "info": {
         "title": "ReqValidation Sample",
         "version": "1.0.0"
      },
      "servers": [
         {
            "url": "/{basePath}",
            "variables": {
               "basePath": {
                 "default": "/v1"
               }
            }
         }
      ],
      "x-amazon-apigateway-request-validators": {
         "all": {
            "validateRequestBody": true,
            "validateRequestParameters": true
         },
         "params-only": {
            "validateRequestBody": false,
            "validateRequestParameters": true
         }
      }
   }

[ OpenAPI 2.0 ]
{
         "swagger": "2.0",
         "info": {
           "title": "ReqValidation Sample",
           "version": "1.0.0"
         },
         "schemes": [
           "https"
         ],
         "basePath": "/v1",
         "produces": [
           "application/json"
         ],
         "x-amazon-apigateway-request-validators" : {
           "all" : {
             "validateRequestBody" : true,
             "validateRequestParameters" : true
           },
           "params-only" : {
             "validateRequestBody" : false,
             "validateRequestParameters" : true
           }
         },
         ...
   }

You select a validator's name when enabling the validator on the API or on a method, as shown in the next step. 

To enable a request validator on all methods of an API, specify an x-amazon-apigateway-request-validator property property at the API level of the OpenAPI definition file. To enable a request validator on an individual method, specify the x-amazon-apigateway-request-validator property at the method level. For example, the following x-amazon-apigateway-request-validator property enables the params-only validator on all API methods, unless otherwise overridden. 


[ OpenAPI 3.0 ]
{
      "openapi": "3.0.0",
      "info": {
         "title": "ReqValidation Sample",
         "version": "1.0.0"
      },
      "servers": [
         {
            "url": "/{basePath}",
            "variables": {
               "basePath": {
                 "default": "/v1"
               }
            }
         }
      ],
      "x-amazon-apigateway-request-validator": "params-only",
      ...
   }

[ OpenAPI 2.0 ]
{
         "swagger": "2.0",
         "info": {
           "title": "ReqValidation Sample",
           "version": "1.0.0"
         },
         "schemes": [
           "https"
         ],
         "basePath": "/v1",
         "produces": [
           "application/json"
         ],
         ...
         "x-amazon-apigateway-request-validator" : "params-only",
         ...
   }

To enable a request validator on an individual method, specify the `x-amazon-apigateway-request-validator` property at the method level\. For example, the following `x-amazon-apigateway-request-validator` property enables the `all` validator on the `POST /validation` method\. This overrides the `params-only` validator that is inherited from the API\.


[ OpenAPI 3.0 ]
{
      "openapi": "3.0.0",
      "info": {
         "title": "ReqValidation Sample",
         "version": "1.0.0"
      },
      "servers": [
         {
            "url": "/{basePath}",
            "variables": {
               "basePath": {
                 "default": "/v1"
               }
            }
         }
      ],
      "paths": {
         "/validation": {
            "post": {
               "x-amazon-apigateway-request-validator": "all",
               ...
            }
         }
      }
      ...
   }

[ OpenAPI 2.0 ]
{
         "swagger": "2.0",
         "info": {
           "title": "ReqValidation Sample",
           "version": "1.0.0"
         },
         "schemes": [
           "https"
         ],
         "basePath": "/v1",
         "produces": [
           "application/json"
         ],
         ...
         "paths": {
           "/validation": {
             "post": {
               "x-amazon-apigateway-request-validator" : "all",
               ...
             },
             ...
           }
         }
         ...
   }


In API Gateway, create the API with request validators enabled by importing this sample OpenAPI definition: 

```
   POST /restapis?mode=import&failonwarning=true HTTP/1.1
   Content-Type: application/json
   Host: apigateway.us-east-1.amazonaws.com
   X-Amz-Date: 20170306T234936Z
   Authorization: AWS4-HMAC-SHA256 Credential={access_key_ID}/20170306/us-east-1/apigateway/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature={sig4_hash}
Copy the JSON object from this sample OpenAPI definition and paste it here.
   ```

Deploy the newly created API (fjd6crafxc) to a specified stage (testStage). 

```
   POST /restapis/fjd6crafxc/deployments HTTP/1.1
   Content-Type: application/json
   Host: apigateway.us-east-1.amazonaws.com
   X-Amz-Date: 20170306T234936Z
   Authorization: AWS4-HMAC-SHA256 Credential={access_key_ID}/20170306/us-east-1/apigateway/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature={sig4_hash}
{
       "stageName" : "testStage",
       "stageDescription" : "Test stage",
       "description" : "First deployment",
       "cacheClusterEnabled" : "false"
   }
   ```
For instructions on how to test the request validation using the API Gateway REST API, see Test basic request validation using the API Gateway REST API. For instructions on how to test using the API Gateway console, see Test basic request validation using the API Gateway console. 
Set up request validators using the API Gateway REST API
In the API Gateway REST API, a request validator is represented by a RequestValidator resource. To have an API support the same request validators as the Sample API, add to the RequestValidators collection a parameters-only validator with params-only as the key, and add a full validator with all as its key. 
To enable the basic request validation using the API Gateway REST API
We assume that you have an API similar to the sample API, but have not set up the request validators. If your API already has request validators enabled, call the appropriate requestvalidator:update or method:put action instead of requestvalidator:create or method:put. 

To set up the params-only request validator, call the requestvalidator:create action as follows: 

```
   POST /restapis/restapi-id/requestvalidators HTTP/1.1
   Content-Type: application/json
   Host: apigateway.region.amazonaws.com
   X-Amz-Date: 20170223T172652Z
   Authorization: AWS4-HMAC-SHA256 Credential={access_key_ID}/20170223/region/apigateway/aws4_request, SignedHeaders=content-type;host;x-amz-date, Signature={sig4_hash}
{
     "name" : "params-only",
     "validateRequestBody" : "false",
     "validateRequestParameters" : "true"
   }
   ```

To set up the all request validator, call the requestvalidator:create action as follows: 

```
   POST /restapis/restapi-id/requestvalidators HTTP/1.1
   Content-Type: application/json
   Host: apigateway.region.amazonaws.com
   X-Amz-Date: 20170223T172652Z
   Authorization: AWS4-HMAC-SHA256 Credential={access_key_ID}/20170223/region/apigateway/aws4_request, SignedHeaders=content-type;host;x-amz-date, Signature={sig4_hash}
{
     "name" : "all",
     "validateRequestBody" : "true",
     "validateRequestParameters" : "true"
   }
   ```
If the preceding validator keys already exist in the `RequestValidators` map, call the [requestvalidator:update](https://docs.aws.amazon.com/apigateway/api-reference/link-relation/requestvalidator-update/) action instead to reset the validation rules\.


To apply the all request validator to the POST method, call method:put to enable the specified validator (as identified by the requestValidatorId property), or call method:update to update the enabled validator. 

```
   PUT /restapis/restapi-id/resources/resource-id/methods/POST HTTP/1.1
   Content-Type: application/json
   Host: apigateway.region.amazonaws.com
   X-Amz-Date: 20170223T172652Z
   Authorization: AWS4-HMAC-SHA256 Credential={access_key_ID}/20170223/region/apigateway/aws4_request, SignedHeaders=content-type;host;x-amz-date, Signature={sig4_hash}
{
     "authorizationType" : "NONE",
     ...,
     "requestValidatorId" : "all"
   }
   ```
Set up basic request validation using the API Gateway console
The API Gateway console lets you set up the basic request validation on a method using one of the three validators: 
 Validate body: This is the body-only validator.
 Validate query string parameters and headers: This is the parameters-only validator.
 Validate body, query string parameters, and headers: This validator is for both body and parameters validation.
When you choose one of the above validators to enable it on an API method, the API Gateway console adds the validator to the API's RequestValidators map if the validator has not already been added to the validators map of the API. 
To enable a request validator on a method


Sign in to the API Gateway console if you're not already logged in.


Create a new or choose an existing API.


Create a new or choose an existing resource of the API.


Create a new or choose an existing method the resource.


Choose Method Request.


Choose the pencil icon of Request Validator under Settings.


Choose Validate body, Validate query string parameters and headers, or Validate body, query string parameters, and headers from the Request Validator drop-down list. Then choose the check mark icon to save your choice. 



To test and use the request validator in the console, follow the instructions in Test basic request validation using the API Gateway console.