Testing Your Setup by Using Commvault
You can back up your data to virtual tapes, archive the tapes, and manage your virtual tape library (VTL) devices by using Commvault version 11. In this topic, you can find basic documentation on how to configure the Commvault backup application for a tape gateway, perform a backup archive, and retrieve your data from archived tapes. For detailed information about how to use Commvault, see the Commvault documentation on the Commvault website.
Topics
 Configuring Commvault to Work with VTL Devices
 Creating a Storage Policy and a Subclient
 Backing Up Data to a Tape in Commvault
 Archiving a Tape in Commvault
 Restoring Data from a Tape
Configuring Commvault to Work with VTL Devices
After you connect the VTL devices to the Windows client, you configure Commvault to recognize them. For information about how to connect VTL devices to the Windows client, see Connecting Your VTL Devices to a Windows client. 
The Commvault backup application doesn't automatically recognize VTL devices. You must manually add devices to expose them to the Commvault backup application and then discover the devices. 
To configure Commvault


In the CommCell console main menu, choose Storage, and then choose Expert Storage Configuration to open the Select MediaAgents dialog box.



Choose the available media agent you want to use, choose Add, and then choose OK.


In the Expert Storage Configuration dialog box, choose Start, and then choose Detect/Configure Devices.


Leave the Device Type options selected, choose Exhaustive Detection, and then choose OK.


In the Confirm Exhaustive Detection confirmation box, choose Yes.


In the Device Selection dialog box, choose your library and all its drives, and then choose OK. Wait for your devices to be detected, and then choose Close to close the log report.


Right-click your library, choose Configure, and then choose Yes. Close the configuration dialog box.


In the Does this library have a barcode reader? dialog box, choose Yes, and then for device type, choose IBM ULTRIUM V5.


In the CommCell browser, choose Storage Resources, and then choose Libraries to see your tape library.



To see your tapes in your library, open the context (right-click) menu for your library, and then choose Discover Media, Media location, Media Library.


To mount your tapes, open the context (right-click) menu for your media, and then choose Load.


Creating a Storage Policy and a Subclient
Every backup and restore job is associated with a storage policy and a subclient policy. 
A storage policy maps the original location of the data to your media.
To create a storage policy


In the CommCell browser, choose Policies.


Open the context (right-click) menu for Storage Policies, and then choose New Storage Policy.


In the Create Storage Policy wizard, choose Data Protection and Archiving, and then choose Next.


Type a name for Storage Policy Name, and then choose Incremental Storage Policy. To associate this storage policy with incremental loads, choose one of the options. Otherwise, leave the options unchecked, and then choose Next.


In the Do you want to Use Global Deduplication Policy? dialog box, choose your Deduplication preference, and then choose Next.


From Library for Primary Copy, choose your VTL library, and then choose Next.


Verify that your media agent settings are correct, and then choose Next.


Verify that your scratch pool settings are correct, and then choose Next.


Configure your retention policies in iData Agent Backup data, and then choose Next.


Review the encryption settings, and then choose Next.


To see your storage policy, choose Storage Policies.


You create a subclient policy and associate it with your storage policy. A subclient policy enables you to configure similar file system clients from a central template, so that you don't have to set up many similar file systems manually.
To create a subclient policy


In the CommCell browser, choose Client Computers, and then choose your client computer. Choose File System, and then choose defaultBackupSet.


Right-click defaultBackupSet, choose All Tasks, and then choose New Subclient.


In the Subclient properties box, type a name in SubClient Name, and then choose OK.


Choose Browse, navigate to the files that you want to back up, choose Add, and then close the dialog box.


In the Subclient property box, choose the Storage Device tab, choose a storage policy from Storage policy, and then choose OK.


In the Backup Schedule window that appears, associate the new subclient with a backup schedule. 


Choose Do Not Schedule for one time or on-demand backups, and then choose OK.


You should now see your subclient in the defaultBackupSet tab.
Backing Up Data to a Tape in Commvault
You create a backup job and write data to a virtual tape by using the same procedures you use with physical tapes. For detailed information about how to back up data, see the Commvault documentation. 
Archiving a Tape in Commvault
You start the archiving process by ejecting the tape. When you archive a tape, tape gateway moves the tape from the tape library to offline storage. Before you eject and archive a tape, you might want to first check the content on the tape. 
To archive a tape


In the CommCell browser, choose Storage Resources, Libraries, and then choose Your library. Choose Media By Location, and then choose Media In Library.


Open the context (right-click) menu for the tape you want to archive, choose All Tasks, choose Export, and then choose OK.


The archiving process can take some time to complete. The initial status of the tape appears as IN TRANSIT TO VTS. When archiving starts, the status changes to ARCHIVING. When archiving is completed, the tape is no longer listed in the VTL.
In the Commvault software, verify that the tape is no longer in the storage slot.
In the navigation pane of the Storage Gateway console, choose Tapes. Verify that your archived tape's status is ARCHIVED. 
Restoring Data from a Tape
You can restore data from a tape that has never been archived and retrieved, or from a tape that has been archived and retrieved. For tapes that have never been archived and retrieved (nonretrieved tapes), you have two options to restore the data:
 Restore by subclient
 Restore by job ID
To restore data from a nonretrieved tape by subclient


In the CommCell browser, choose Client Computers, and then choose your client computer. Choose File System, and then choose defaultBackupSet.


Open the context (right-click) menu for your subclient, choose Browse and Restore, and then choose View Content.


Choose the files you want to restore, and then choose Recover All Selected.


Choose Home, and then choose Job Controller to monitor the status of your restore job.


To restore data from a nonretrieved tape by job ID


In the CommCell browser, choose Client Computers, and then choose your client computer. Right-click File System, choose View, and then choose Backup History.


In the Backup Type category, choose the type of backup jobs you want, and then choose OK. A tab with the history of backup jobs appears.


Find the Job ID you want to restore, right-click it, and then choose Browse and Restore.


In the Browse and Restore Options dialog box, choose View Content.


Choose the files that you want to restore, and then choose Recover All Selected.


Choose Home, and then choose Job Controller to monitor the status of your restore job.


To restore data from an archived and retrieved tape


In the CommCell browser, choose Storage Resources, choose Libraries, and then choose Your library. Choose Media By Location, and then choose Media In Library.


Right-click the retrieved tape, choose All Tasks, and then choose Catalog. 


In the Catalog Media dialog box, choose Catalog only, and then choose OK.


Choose CommCell Home, and then choose Job Controller to monitor the status of your restore job.


After the job succeeds, open the context (right-click) menu for your tape, choose View, and then choose View Catalog Contents. Take note of the Job ID value for use later.


Choose Recatalog/Merge. Make sure that Merge only is chosen in the Catalog Media dialog box.


Choose Home, and then choose Job Controller to monitor the status of your restore job.


After the job succeeds, choose CommCell Home, choose Control Panel, and then choose Browse/Search/Recovery.


Choose Show aged data during browse and recovery, choose OK, and then close the Control Panel. 


In the CommCell browser, right-click Client Computers, and then choose your client computer. Choose View, and then choose Job History.


In the Job History Filter dialog box, choose Advanced.


Choose Include Aged Data, and then choose OK.


In the Job History dialog box, choose OK to open the history of jobs tab.


Find the job that you want to restore, open the context (right-click) menu for it, and then choose Browse and Restore.


In the Browse and Restore dialog box, choose View Content.


Choose the files that you want to restore, and then choose Recover All Selected.


Choose Home, and then choose Job Controller to monitor the status of your restore job.

