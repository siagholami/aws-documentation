# Researching AWS CloudTrail Data<a name="cloudtraildata"></a>

**Topics**
+ [Analyzing CloudTrail Search Results](#cloudtrailsearchresults)
+ [CloudTrail Data Fields and Sample Queries](#cloudtrailfields)

## Analyzing CloudTrail Search Results<a name="cloudtrailsearchresults"></a>

The following section describes the elements of the search results that get displayed when you use the **Research** tab to investigate your Macie\-monitored CloudTrail data\.

Complete the following steps in the **Research** tab\.

1. Select **CloudTrail data** in the first filter dropdown\.

1. For this example, select **Top 10** in the second filter dropdown\.

1. For this example, select **Past 90** days in the third filter dropdown\.

1. Choose the button with the looking glass icon to start the search\.

Your search produces the following elements:
+ The **total number of results** that matched your CloudTrail data search for the selected time range\.
+ The **graphical representation** of CloudTrail data search results for the selected time range\. 
**Note**  
If your dataset is very large and you specify a very wide time range, your data might not render properly, and this graph might not appear as one of the resulting elements of your search\.
**Important**  
You can use the graph to further narrow your search and generate and run a query that produces a subset of the results generated by your original selections in the preceding steps\. Double\-click any of the graph's results and your selection is translated into a new query that automatically appears in the query parser, and the **Research** tab is refreshed with the results of this new query\. 
+ **Search results summary** â€“ A list of the most significant fields from your search\. The first line includes the top \(or bottom\) three values for each field\. The second line includes the top \(or bottom\) 10 values for each field\. 
**Important**  
You can use the fields in the search results summary to further narrow your search and generate and run a query that produces a subset of the results generated by your original selections in the preceding steps\. Choose the first or the second line of results for any field, and in the expanded results breakdown, choose the looking glass icon next to any of the results\. Your choices are then translated into a new query that automatically appears in the query parser, and the **Research** tab is refreshed with the results of this new query\.
+ A list of **user sessions** \(5\-minute aggregates of CloudTrail data\) that match your search criteria\. Choose any user session to expand it and view its details\. 

## CloudTrail Data Fields and Sample Queries<a name="cloudtrailfields"></a>

The following tables include the fields that can appear in the results of your CloudTrail data searches\.
+ The first table includes the fields that Macie extracts from CloudTrail\. These fields also include Amazon S3 data events\. For example, `accountId` in Macie corresponds to `userIdentity.accountId` in CloudTrail, and `eventNameErrorCode.key` in Macie corresponds to `eventName` in CloudTrail\. 
+ The second table includes the fields that Macie generates to provide further security intelligence and context based on the examined CloudTrail data\. For example, `isp.key` describes the organization or the ISP that the API request against your AWS resources is coming from, and `sourceIPAddress.ip_intel.type` describes the IP address history: for example, whether it's a Tor exit node that is being used to initiate API requests against your AWS resources\. 

### CloudTrail Data Fields That Macie Extracts<a name="cloudtrailfields_extracted"></a>

**Note**  
For this data repository \(CloudTrail\), your search always returns a list of user sessions: 5\-minute aggregates of raw CloudTrail data\. A user session is determined by the Macie unique ID: a format that is unique to Macie for specifying users\. Macie unique ID is a combination of the IAM `UserIdentity` element and the `recipientAccountId`\. 


| Macie Field Name | CloudTrail Field Name | Macie Field Type | Description | Example Search Query | 
| --- | --- | --- | --- | --- | 
| `accountId` | `userIdentity.accountId` | String | The AWS account ID\.  | Search for user sessions with accesses related to a particular account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `awsRegion.key` | `awsRegion` | String | The AWS Region that the request is made to\.  | Search for user sessions with any AWS API calls by Region:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventNameErrorCode.key` | `eventName` | String |  The event name that resulted in the returned \(if any\) error code\.   |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventNameErrorCode.secondary` | `errorCode` | String | The error code returned after an unsuccessful API request\.  | Search for user sessions with any `AccessDenied` error across all CloudTrail API events:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventSource.key` | `eventSource` | String | The service that the request was made to\.  | Search for user sessions with any API calls of a particular AWS service:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventType.key` | `eventType` | String | The type of the event that generated the event record \(for example, `AwsApiCall`, `AwsServiceEvent`, or `AwsConsoleSignIn`\)\.   | Search for user sessions with any AWS API calls of a particular `eventType`:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `objectsDeleted.key` | `Resources[0].ARN` | String | A list of S3 objects ARNs, S3 bucket ARNs, or prefix ARNs that were part of a `DeleteObject` or `DeleteObjects` API call\.  When you delete an S3 bucket, both `DeleteBucket` and `DeleteObjects` APIs are called\. The aggregate record with the `DeleteObjects` call lists the deleted bucket or prefix, not all the individual objects that were deleted\.   Objects that are part of a failed `DeleteObject` or `DeleteObjects` API call are also added to the aggregate record of `objectsDeleted.key`\.   A user session returning the results of a search against `objectsDeleted.key` has a maximum limit of 250 records\.   |  Search for all objects deleted from a particular bucket or prefix:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for all `Delete` requests of a particular object that were made anonymously or by any user or role\.  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions that contain both a `DeleteObject:AccessDenied` and any attempt to delete a particular sensitive object, bucket, or prefix\.  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions that contain both an attempt \(or attempts\) to delete S3 objects from outside AWS and any attempt to delete a particular sensitive object, bucket, or prefix:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for anonymous delete requests of a known sensitive object:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `objectsRead.key` | `Resources[0].ARN` | String | A list of S3 object ARNs that were part of a `GetObject` API call\.  Objects that are part of a failed `GetObject` API call are also added to the aggregate record of `objectsRead.key`\.   A user session that returns the results of a search against `objectsRead.key` has a maximum limit of 250 records\.   |  Search for user sessions with all objects read from a particular bucket or prefix:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for all access attempts of a particular object made either anonymously or by any user or role\.  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  Search for user sessions that contain both a `GetObject:AccessDenied` and any attempt to read a particular sensitive object, bucket, or prefix\.  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions that contain both an attempt \(or attempts\) to read S3 objects from outside AWS and any attempt to read a particular sensitive object, bucket, or prefix:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for anonymous read accesses to a known sensitive object or bucket:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `objectsWritten.key` | `Resources[0].ARN` | String | A list of S3 object ARNs that were part of a `PutObject`, `CopyObject`, or `CompleteMultipartUpload` API call\.  Objects that are part of a failed `PutObject` API call are also added to the aggregate record of `objectsWritten.key`\.   A user session that returns the results of a search against `objectsWritten.key` has a maximum limit of 250 records\.   |  Search for user sessions with all objects written to a particular bucket:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions with all write requests of a particular object made either anonymously or by any user or role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions that contain both a `PutObject:AccessDenied` and any attempt to read a particular sensitive object, bucket, or prefix\.  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions that contain both an attempt \(or attempts\) to write S3 objects from outside AWS and any attempt to write a particular sensitive object, bucket, or prefix:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for anonymous write requests to a sensitive object or bucket:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `principalId` | `userIdentity.principalId` | String | The IAM principal ID\.   When an assumed role makes a request, the session name is removed from the principal ID\.   | Search for user sessions with access requests from a particular principal ID:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `recipientAccountId` | `recipientAccountId` | String | The account ID that received the CloudTrail event\.   |  Search for all activity in a particular account: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for anonymous access requests to a particular account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `resourceOwnerAccountIds.key` | `Resources[1].accountId` | String | List of AWS resource owners\. An example is a list of account IDs that own an S3 object or bucket\.   | Search for activity against resources owned by a particular account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `resources.key` | `Resources[0].accountId` | String | List of resources \(S3 buckets only\) associated with the CloudTrail events in the user session\.   |  Search for access requests to a particular S3 bucket: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for anonymous access requests to a known sensitive bucket: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `sessionName.key` | `userIdentity.principalId` | String |  The identifier for the assumed role session\. When an assumed role makes a request, the session name is removed from the principal ID and is assigned as a value to `sessionName.key`\. When an identity other than an assumed role makes a request, `sessionName.key` is set to `None`\. |  Search for assumed role access requests from session name `examplesession-cli`:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for EC2 instance IDs in session names:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for assumed role access requests to a role from a `sessionName` other than `examplesession-cli` using regex negation:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `sourceARN` | `userIdentity.arn`  | String | The ARN used to make the request\.  When an assumed role makes a request, the session name is removed from `sourceARN`\.   |  Search for user sessions with access requests from a particular ARN:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `sourceIPAddress.key` | `sourceIPAddress`  | String | The IP address that the request was made from\.   A user session that returns the results of a search against `sourceIPAddress.key` has a maximum limit of 60,000 records\.   |  Search for user sessions with access requests from a particular source IP address:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search through user sessions with source IP addresses using wildcards:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions with more than 10 `RunInstances` events and without any events requested by the `autoscaling` group:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `userAgent.key` | `userAgent`  | String | A list of client user agent strings used to make the AWS API call\.  |  Search for user sessions with API calls executed by Amazon S3: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `userIdentityType.key` | `userIdentity.type`   | String | A list of identity types in AWS\.  |  Search for user sessions with access requests by the root identity in an account: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 

### Fields That Macie Generates<a name="cloudtrailfields_macie-generated"></a>

**Note**  
For this data repository \(CloudTrail\), your search always returns a list of user sessions: 5\-minute aggregates of raw CloudTrail data\. A user session is determined by the Macie unique ID: a format that is unique to Macie for specifying users\. The Macie unique ID is a combination of the IAM `UserIdentity` element and the `recipientAccountId`\. 


| Macie Field Name | Macie Field Type | Description | Example Search Query | 
| --- | --- | --- | --- | 
| `@timestamp` | Date | The start time of a user session\.  |  Search for user sessions with access requests after a specific time:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions with access requests between two time intervals: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `countLongLifeAccessToken` | Integer | A count of `GetSessionToken` API calls with a lifespan longer than the default 43,200 seconds\.  | Search for user sessions with a user or role creating a temporary access token with a longer than the default lifespan:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `dcObjectsDeleted` | Integer | A count of unique S3 objects deleted in a user session\.  A user session that returns the results of a search against `dcObjectsDeleted` has a maximum limit of 250 entries\.    | Search for user sessions with more than 25 distinct objects deleted by an AWS user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `dcObjectsRead` | Integer | A count of unique S3 objects read in a user session\.  A user session that returns the results of a search against `dcObjectsRead` has a maximum limit of 250 entries\.    |  Search for user sessions with more than 25 distinct objects read by an AWS user or a role: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for more than 25 distinct objects read by an anonymous principal during a user session: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `dcObjectsWritten` | Integer | A count of unique S3 objects written in a user session\.  A user session that returns the results of a search against `dcObjectsWritten` has a maximum limit of 250 entries\.    | Search for user sessions with more than 25 distinct objects written by an AWS user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `distinctEventName` | Integer | A count of unique event names that take place in a user session\.  | Search for user sessions with more than 25 unique API calls being executed by a user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `distinctSourceIPAddress` | Integer | A count of unique source IP addresses involved in activity that takes place in a user session\. The maximum value is 60,000\.  | Search for user sessions with more than 25 distinct source IP addresses observed for a user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `distinctUserAgent` | Integer | A count of unique client user agents involved in activity that takes place in a user session\. The maximum value is 60,000\.  | Search for user sessions with more than 25 user agents observed for a user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventNameErrorCode.compound` | String | A compound aggregation that summarizes each CloudTrail event name along with any error codes that are associated with the API Call\. The format is `EventName:ErrorCode` for the term value, which enables Macie to associate an API event name with the error code, if any, that is returned\. If there is no error code for the event, the value is set only to the API name with no colon, for example: `PutObject`\.  |  Search for user sessions with `AccessDenied` error while attempting a `GetObject` call: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions with any errors associated with `PutObject` calls: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventNameIsp.compound` | String | A compound aggregation that summarizes each CloudTrail event name along with the Internet Service Provider \(ISP\) that the request originated from\. The format is `EventName:ISP` for the term value, which enables Macie to associate an API operation name with the ISP that it originated from\.  | Search for user sessions with `ConsoleLogin` calls from non\-AWS IPs using a regular expression:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `eventNameIsp.secondary` | String | The ISP that the AWS API call was made from\.  | Search for user sessions with AWS API calls coming from outside Amazon IP addresses:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `macieUniqueId` | String | A format that is unique to Macie for specifying users\. The Macie unique ID is a combination of the IAM `UserIdentity` element and the `recipientAccountId`\. For more information, see [MacieUniqueID](macie-users.md#macie-users-concepts)\.  | Search for user sessions with accesses from a particular role, user, or root account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `sourceIPAddress.ip_intel.type` | String | The IP intelligence category associated with a source IP address\.  |  Search for user sessions with all accesses from a Tor network: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user sessions with all accesses from threat intelligence input feeds: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `windowStartTimeInMillis` | Integer | The epoch timestamp for the start of a user session\.  | Search for user sessions whose first event time is greater than a given epoch time:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `windowEndTimeInMillis` | Integer | The epoch timestamp for the end of a user session\.  | Search for user sessions whose last event time is less than a given epoch time:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `ipLocation.key` | String | The IP geolocation \(city and country\) accessed by an identity that Macie monitors\.  |  Search for user sessions with any AWS API call events originating in Los Angeles: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) Search for user session any AWS API call events originating from outside the United States: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| `isp.key` | String | The ISP that the AWS API call originated from\.  | Search for user sessions with AWS API calls coming from outside Amazon IP addresses:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 