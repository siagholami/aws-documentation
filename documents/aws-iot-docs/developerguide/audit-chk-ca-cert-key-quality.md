# CA certificate key quality<a name="audit-chk-ca-cert-key-quality"></a>

AWS IoT customers often rely on TLS mutual authentication using X\.509 certificates for authenticating to AWS IoT message broker\. These certificates and their certificate authority certificates must be registered in their AWS IoT account before they are used\. AWS IoT performs basic sanity checks on these certificates when they are registered, including:
+ The certificates are in a valid format\.
+ The certificates are within their validity period \(in other words, not expired\)\.
+ Their cryptographic key sizes meet a minimum required size \(for RSA keys, they must be 2048 bits or larger\)\.

This audit check provides the following additional tests of the quality of your cryptographic key:
+ CVE\-2008\-0166 – Check whether the key was generated using OpenSSL 0\.9\.8c\-1 up to versions before 0\.9\.8g\-9 on a Debian\-based operating system\. Those versions of OpenSSL use a random number generator that generates predictable numbers, making it easier for remote attackers to conduct brute force guessing attacks against cryptographic keys\.
+ CVE\-2017\-15361 – Check whether the key was generated by the Infineon RSA library 1\.02\.013 in Infineon Trusted Platform Module \(TPM\) firmware, such as versions before 0000000000000422 – 4\.34, before 000000000000062b – 6\.43, and before 0000000000008521 – 133\.33\. That library mishandles RSA key generation, making it easier for attackers to defeat some cryptographic protection mechanisms through targeted attacks\. Examples of affected technologies include BitLocker with TPM 1\.2, YubiKey 4 \(before 4\.3\.5\) PGP key generation, and the Cached User Data encryption feature in Chrome OS\.

AWS IoT Device Defender reports certificates as noncompliant if they fail these tests\.

This check appears as `CA_CERTIFICATE_KEY_QUALITY_CHECK` in the CLI and API\.

Severity: **Critical**

## Details<a name="audit-chk-ca-cert-key-quality-details"></a>

This check applies to CA certificates that are ACTIVE or PENDING\_TRANSFER\.

The following reason codes are returned when this check finds a noncompliant certificate:
+ CERTIFICATE\_KEY\_VULNERABILITY\_CVE\-2017\-15361
+ CERTIFICATE\_KEY\_VULNERABILITY\_CVE\-2008\-0166

## Why it matters<a name="audit-chk-ca-cert-key-quality-why-it-matters"></a>

Newly added devices signed using this CA certificate might pose a security threat\.

## How to fix it<a name="audit-chk-ca-cert-key-quality-how-to-fix"></a>

1. Use [UpdateCACertificate](https://docs.aws.amazon.com/iot/latest/apireference/API_UpdateCACertificate.html) to mark the CA certificate as INACTIVE in AWS IoT\. You can also use mitigation actions to:
   + Apply the `UPDATE_CA_CERTIFICATE` mitigation action on your audit findings to make this change\. 
   + Apply the `PUBLISH_FINDINGS_TO_SNS` mitigation action if you want to implement a custom response in response to the Amazon SNS message\. 

   For more information, see [Mitigation actions](device-defender-mitigation-actions.md)\.

1. Review the device certificate registration activity for the time after the CA certificate was revoked and consider revoking any device certificates that might have been issued with it during this time\. \(Use [ListCertificatesByCA](https://docs.aws.amazon.com/iot/latest/apireference/API_ListCertificatesByCA.html) to list the device certificates signed by the CA certificate and [UpdateCertificate](https://docs.aws.amazon.com/iot/latest/apireference/API_UpdateCertificate.html) to revoke a device certificate\.\)