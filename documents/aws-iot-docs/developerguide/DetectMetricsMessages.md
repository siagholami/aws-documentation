# Sending metrics from devices<a name="DetectMetricsMessages"></a>

AWS IoT Device Defender Detect can collect, aggregate, and monitor metrics data generated by AWS IoT devices to identify devices that exhibit abnormal behavior\. This section shows you how to send metrics from a device to AWS IoT Device Defender\.

You must securely deploy the AWS IoT SDK on your AWS IoT connected devices or device gateways to collect device\-side metrics\. AWS IoT Device Defender provides sample agents to use as examples when you create your own\. If you can't provide device metrics, you can still get limited functionality based on cloud\-side metrics\.

Note the following:
+ A sample device metric reporting agent is currently available in C at [https://github\.com/aws\-samples/aws\-iot\-device\-defender\-agent\-c](https://github.com/aws-samples/aws-iot-device-defender-agent-c)\. There is also a sample device metric reporting agent available in Python on GitHub at [ https://github\.com/aws\-samples/aws\-iot\-device\-defender\-agent\-sdk\-python](https://github.com/aws-samples/aws-iot-device-defender-agent-sdk-python)\. Specifically, see the [greengrass\_defender\_agent\.py](https://github.com/aws-samples/aws-iot-device-defender-agent-sdk-python/tree/master/samples/greengrass/greengrass_core_metrics_agent) file\.
+ To use the sample agents or create your own custom agent, you must install the AWS IoT Device SDK\. To find resources for your development language, see [AWS IoT Core Resources](https://aws.amazon.com/iot-core/resources)\.
+ All agents must create a connection to AWS IoT and publish metrics to one of these reserved AWS IoT Device Defender MQTT topics: 

  ```
  $aws/things/THING_NAME/defender/metrics/json
  ```

  or

  ```
  $aws/things/THING_NAME/defender/metrics/cbor
  ```

  AWS IoT Device Defender uses one of these topics to reply with the receipt status of your metrics reports:

  ```
  $aws/things/THING_NAME/defender/metrics/json/accepted
  ```

  ```
  $aws/things/THING_NAME/defender/metrics/cbor/accepted
  ```

  ```
  $aws/things/THING_NAME/defender/metrics/json/rejected
  ```

  ```
  $aws/things/THING_NAME/defender/metrics/cbor/rejected
  ```
+ To report metrics, a device must be registered as a thing in AWS IoT\.
+ A device should, generally, send a metric report once every 5 minutes\. Devices are throttled to one metric report every 5 minutes\. \(A device can't make more than one metric report every 5 minutes\.\)
+ Devices must report current metrics\. Historical metrics reporting isn't supported\.
+ You can optionally use [Jobs](iot-jobs.md) to change how often Device Defender sends metrics\. An example is included with the AWS IoT Device Defender Agent C samples\. For more information, see the [README\.md](https://github.com/aws-samples/aws-iot-device-defender-agent-c/blob/master/README.md)\.