# MySQL Database Log Files<a name="USER_LogAccess.Concepts.MySQL"></a>

You can monitor the MySQL error log, slow query log, and the general log\. The MySQL error log is generated by default; you can generate the slow query and general logs by setting parameters in your DB parameter group\. Amazon RDS rotates all of the MySQL log files; the intervals for each type are given following\. 

You can monitor the MySQL logs directly through the Amazon RDS console, Amazon RDS API, AWS CLI, or AWS SDKs\. You can also access MySQL logs by directing the logs to a database table in the main database and querying that table\. You can use the mysqlbinlog utility to download a binary log\. 

For more information about viewing, downloading, and watching file\-based database logs, see [Amazon Aurora Database Log Files](USER_LogAccess.md)\.

**Topics**
+ [Accessing MySQL Error Logs](#USER_LogAccess.MySQL.Errorlog)
+ [Accessing the MySQL Slow Query and General Logs](#USER_LogAccess.MySQL.Generallog)
+ [Publishing Aurora MySQL Logs to Amazon CloudWatch Logs](#USER_LogAccess.MySQLDB.PublishAuroraMySQLtoCloudWatchLogs)
+ [Log File Size](#USER_LogAccess.MySQL.LogFileSize)
+ [Managing Table\-Based MySQL Logs](#Appendix.MySQL.CommonDBATasks.Logs)
+ [Binary Logging Format](#USER_LogAccess.MySQL.BinaryFormat)
+ [Accessing MySQL Binary Logs](#USER_LogAccess.MySQL.Binarylog)

## Accessing MySQL Error Logs<a name="USER_LogAccess.MySQL.Errorlog"></a>

The MySQL error log is written to the `mysql-error.log` file\. You can view `mysql-error.log` by using the Amazon RDS console or by retrieving the log using the Amazon RDS API, Amazon RDS CLI, or AWS SDKs\. `mysql-error.log` is flushed every 5 minutes, and its contents are appended to `mysql-error-running.log`\. The `mysql-error-running.log` file is then rotated every hour and the hourly files generated during the last 30 days are retained\. Note that the retention period is different between Amazon RDS and Aurora\.

Each log file has the hour it was generated \(in UTC\) appended to its name\. The log files also have a timestamp that helps you determine when the log entries were written\.

MySQL writes to the error log only on startup, shutdown, and when it encounters errors\. A DB instance can go hours or days without new entries being written to the error log\. If you see no recent entries, it's because the server did not encounter an error that would result in a log entry\.

## Accessing the MySQL Slow Query and General Logs<a name="USER_LogAccess.MySQL.Generallog"></a>

The MySQL slow query log and the general log can be written to a file or a database table by setting parameters in your DB parameter group\. For information about creating and modifying a DB parameter group, see [Working with DB Parameter Groups and DB Cluster Parameter Groups](USER_WorkingWithParamGroups.md)\. You must set these parameters before you can view the slow query log or general log in the Amazon RDS console or by using the Amazon RDS API, Amazon RDS CLI, or AWS SDKs\.

You can control MySQL logging by using the parameters in this list:
+ `slow_query_log`: To create the slow query log, set to 1\. The default is 0\.
+ `general_log`: To create the general log, set to 1\. The default is 0\.
+ `long_query_time`: To prevent fast\-running queries from being logged in the slow query log, specify a value for the shortest query run time to be logged, in seconds\. The default is 10 seconds; the minimum is 0\. If log\_output = FILE, you can specify a floating point value that goes to microsecond resolution\. If log\_output = TABLE, you must specify an integer value with second resolution\. Only queries whose run time exceeds the `long_query_time` value are logged\. For example, setting `long_query_time` to 0\.1 prevents any query that runs for less than 100 milliseconds from being logged\.
+ `log_queries_not_using_indexes`: To log all queries that do not use an index to the slow query log, set to 1\. The default is 0\. Queries that do not use an index are logged even if their run time is less than the value of the `long_query_time` parameter\.
+ `log_output option`: You can specify one of the following options for the `log_output` parameter\. 
  + **TABLE** – Write general queries to the `mysql.general_log` table, and slow queries to the `mysql.slow_log` table\. 
  + **FILE** – Write both general and slow query logs to the file system\. Log files are rotated hourly\. 
  + **NONE** – Disable logging\.

  For Aurora MySQL 5\.6, the default for `log_output` is `TABLE`\. For Aurora MySQL 5\.7, the default for `log_output` is `FILE`\.

When logging is enabled, Amazon RDS rotates table logs or deletes log files at regular intervals\. This measure is a precaution to reduce the possibility of a large log file either blocking database use or affecting performance\. `FILE` and `TABLE` logging approach rotation and deletion as follows:
+ When `FILE` logging is enabled, log files are examined every hour and log files older than 24 hours are deleted\. In some cases, the remaining combined log file size after the deletion might exceed the threshold of 2 percent of a DB instance's allocated space\. In these cases, the largest log files are deleted until the log file size no longer exceeds the threshold\. 
+ When `TABLE` logging is enabled, in some cases log tables are rotated every 24 hours\. This rotation occurs if the space used by the table logs is more than 20 percent of the allocated storage space or the size of all logs combined is greater than 10 GB\. If the amount of space used for a DB instance is greater than 90 percent of the DB instance's allocated storage space, then the thresholds for log rotation are reduced\. Log tables are then rotated if the space used by the table logs is more than 10 percent of the allocated storage space or the size of all logs combined is greater than 5 GB\. You can subscribe to the `low_free_storage` event to be notified when log tables are rotated to free up space\. For more information, see [Using Amazon RDS Event Notification](USER_Events.md)\.

  When log tables are rotated, the current log table is copied to a backup log table and the entries in the current log table are removed\. If the backup log table already exists, then it is deleted before the current log table is copied to the backup\. You can query the backup log table if needed\. The backup log table for the `mysql.general_log` table is named `mysql.general_log_backup`\. The backup log table for the `mysql.slow_log` table is named `mysql.slow_log_backup`\.

  You can rotate the `mysql.general_log` table by calling the `mysql.rds_rotate_general_log` procedure\. You can rotate the `mysql.slow_log` table by calling the `mysql.rds_rotate_slow_log` procedure\.

  Table logs are rotated during a database version upgrade\.

To work with the logs from the Amazon RDS console, Amazon RDS API, Amazon RDS CLI, or AWS SDKs, set the `log_output` parameter to FILE\. Like the MySQL error log, these log files are rotated hourly\. The log files that were generated during the previous 72 hours are retained\. Note that the retention period is different between Amazon RDS and Aurora\.

For more information about the slow query and general logs, go to the following topics in the MySQL documentation:
+ [The Slow Query Log](https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html)
+ [The General Query Log](https://dev.mysql.com/doc/refman/8.0/en/query-log.html)

## Publishing Aurora MySQL Logs to Amazon CloudWatch Logs<a name="USER_LogAccess.MySQLDB.PublishAuroraMySQLtoCloudWatchLogs"></a>

You can configure your Aurora MySQL DB cluster to publish log data to a log group in Amazon CloudWatch Logs\. With CloudWatch Logs, you can perform real\-time analysis of the log data, and use CloudWatch to create alarms and view metrics\. You can use CloudWatch Logs to store your log records in highly durable storage\. For more information, see [Publishing Amazon Aurora MySQL Logs to Amazon CloudWatch Logs](AuroraMySQL.Integrating.CloudWatch.md)\.

## Log File Size<a name="USER_LogAccess.MySQL.LogFileSize"></a>

The MySQL slow query log, error log, and the general log file sizes are constrained to no more than 2 percent of the allocated storage space for a DB instance\. To maintain this threshold, logs are automatically rotated every hour and log files older than 24 hours are removed\. If the combined log file size exceeds the threshold after removing old log files, then the largest log files are deleted until the log file size no longer exceeds the threshold\.

For MySQL, there is a size limit on BLOBs written to the redo log\. To account for this limit, ensure that the `innodb_log_file_size` parameter for your MySQL DB instance is 10 times larger than the largest BLOB data size found in your tables, plus the length of other variable length fields \(`VARCHAR`, `VARBINARY`, `TEXT`\) in the same tables\. For information on how to set parameter values, see [Working with DB Parameter Groups and DB Cluster Parameter Groups](USER_WorkingWithParamGroups.md)\. For information on the redo log BLOB size limit, go to [Changes in MySQL 5\.6\.20](http://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-20.html)\.

## Managing Table\-Based MySQL Logs<a name="Appendix.MySQL.CommonDBATasks.Logs"></a>

You can direct the general and slow query logs to tables on the DB instance by creating a DB parameter group and setting the `log_output` server parameter to `TABLE`\. General queries are then logged to the `mysql.general_log` table, and slow queries are logged to the `mysql.slow_log` table\. You can query the tables to access the log information\. Enabling this logging increases the amount of data written to the database, which can degrade performance\.

Both the general log and the slow query logs are disabled by default\. In order to enable logging to tables, you must also set the `general_log` and `slow_query_log` server parameters to `1`\.

Log tables keep growing until the respective logging activities are turned off by resetting the appropriate parameter to `0`\. A large amount of data often accumulates over time, which can use up a considerable percentage of your allocated storage space\. Amazon RDS does not allow you to truncate the log tables, but you can move their contents\. Rotating a table saves its contents to a backup table and then creates a new empty log table\. You can manually rotate the log tables with the following command line procedures, where the command prompt is indicated by `PROMPT>`: 

```
PROMPT> CALL mysql.rds_rotate_slow_log;
PROMPT> CALL mysql.rds_rotate_general_log;
```

 To completely remove the old data and reclaim the disk space, call the appropriate procedure twice in succession\. 

## Binary Logging Format<a name="USER_LogAccess.MySQL.BinaryFormat"></a>

MySQL on Amazon Aurora supports the *row\-based*, *statement\-based*, and *mixed* binary logging formats for MySQL version 5\.6 and later\. The default binary logging format is mixed\. For details on the different MySQL binary log formats, see [Binary Logging Formats](https://dev.mysql.com/doc/refman/8.0/en/binary-log-formats.html) in the MySQL documentation\.

If you plan to use replication, the binary logging format is important because it determines the record of data changes that is recorded in the source and sent to the replication targets\. For information about the advantages and disadvantages of different binary logging formats for replication, see [Advantages and Disadvantages of Statement\-Based and Row\-Based Replication](https://dev.mysql.com/doc/refman/8.0/en/replication-sbr-rbr.html) in the MySQL documentation\.

**Important**  
Setting the binary logging format to row\-based can result in very large binary log files\. Large binary log files reduce the amount of storage available for a DB cluster and can increase the amount of time to perform a restore operation of a DB cluster\.  
Statement\-based replication can cause inconsistencies between the source DB cluster and a read replica\. For more information, see [ Determination of Safe and Unsafe Statements in Binary Logging](https://dev.mysql.com/doc/refman/8.0/en/replication-rbr-safe-unsafe.html) in the MySQL documentation\.

**To set the MySQL binary logging format**

1. Open the Amazon RDS console at [https://console\.aws\.amazon\.com/rds/](https://console.aws.amazon.com/rds/)\.

1. In the navigation pane, choose **Parameter groups**\.

1. Choose the parameter group used by the DB cluster you want to modify\.

   You can't modify a default parameter group\. If the DB cluster is using a default parameter group, create a new parameter group and associate it with the DB cluster\.

   For more information on parameter groups, see [Working with DB Parameter Groups and DB Cluster Parameter Groups](USER_WorkingWithParamGroups.md)\.

1. From **Parameter group actions**, choose **Edit**\.

1. Set the `binlog_format` parameter to the binary logging format of your choice \(**ROW**, **STATEMENT**, or **MIXED**\)\.

1. Choose **Save changes** to save the updates to the DB cluster parameter group\.

**Important**  
Changing a DB cluster parameter group affects all DB clusters that use that parameter group\. If you want to specify different binary logging formats for different Aurora MySQL DB clusters in an AWS Region, the DB clusters must use different DB cluster parameter groups\. These parameter groups identify different logging formats\. Assign the appropriate DB cluster parameter group to each DB clusters\. For more information about Aurora MySQL parameters, see [Aurora MySQL Parameters](AuroraMySQL.Reference.md#AuroraMySQL.Reference.ParameterGroups)\.

## Accessing MySQL Binary Logs<a name="USER_LogAccess.MySQL.Binarylog"></a>

You can use the mysqlbinlog utility to download or stream binary logs from Amazon RDS instances running MySQL 5\.6 or later\. The binary log is downloaded to your local computer, where you can perform actions such as replaying the log using the mysql utility\. For more information about using the mysqlbinlog utility, go to [Using mysqlbinlog to Back Up Binary Log Files](https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog-backup.html)\.

 To run the mysqlbinlog utility against an Amazon RDS instance, use the following options: 
+  Specify the `--read-from-remote-server` option\. 
+  `--host`: Specify the DNS name from the endpoint of the instance\. 
+  `--port`: Specify the port used by the instance\. 
+  `--user`: Specify a MySQL user that has been granted the replication slave permission\. 
+  `--password`: Specify the password for the user, or omit a password value so that the utility prompts you for a password\. 
+ To have the file downloaded in binary format, specify the `--raw` option\. 
+  `--result-file`: Specify the local file to receive the raw output\. 
+ Specify the names of one or more binary log files\. To get a list of the available logs, use the SQL command SHOW BINARY LOGS\.
+ To stream the binary log files, specify the `--stop-never` option\. 

For more information about mysqlbinlog options, go to [mysqlbinlog \- Utility for Processing Binary Log Files](https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html)\. 

For example, see the following\. 

For Linux, macOS, or Unix:

```
mysqlbinlog \
    --read-from-remote-server \
    --host=MySQL56Instance1.cg034hpkmmjt.region.rds.amazonaws.com \
    --port=3306  \
    --user ReplUser \
    --password \
    --raw \
    --result-file=/tmp/ \
    binlog.00098
```

For Windows:

```
mysqlbinlog ^
    --read-from-remote-server ^
    --host=MySQL56Instance1.cg034hpkmmjt.region.rds.amazonaws.com ^
    --port=3306  ^
    --user ReplUser ^
    --password ^
    --raw ^
    --result-file=/tmp/ ^
    binlog.00098
```

Amazon RDS normally purges a binary log as soon as possible, but the binary log must still be available on the instance to be accessed by mysqlbinlog\. To specify the number of hours for RDS to retain binary logs, use the `mysql.rds_set_configuration` stored procedure and specify a period with enough time for you to download the logs\. After you set the retention period, monitor storage usage for the DB instance to ensure that the retained binary logs don't take up too much storage\.

**Note**  
The `mysql.rds_set_configuration` stored procedure is only available for MySQL version 5\.6 or later\.

The following example sets the retention period to 1 day\.

```
call mysql.rds_set_configuration('binlog retention hours', 24);
```

To display the current setting, use the `mysql.rds_show_configuration` stored procedure\.

```
call mysql.rds_show_configuration;
```