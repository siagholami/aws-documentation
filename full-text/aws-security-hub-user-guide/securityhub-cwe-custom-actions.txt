Using custom actions to send findings and insight results to CloudWatch Events
To use Security Hub custom actions to send findings or insight results to CloudWatch Events, you first create the custom action in Security Hub. Then define the rule in CloudWatch Events.
The rule in CloudWatch Events uses the ARN from the custom action.
Creating a custom action (console)
When you create a custom action, you specify the name, description, and a unique identifier.
To create a custom action in Security Hub (console)


Open the AWS Security Hub console at https://console.aws.amazon.com/securityhub/.


In the navigation pane, choose Settings and then choose Custom actions.


Choose Create custom action.


Provide a Name, Description, and Custom action ID for the action.


The Name must be fewer than 20 characters.
The Custom action ID must be unique per AWS account.


Choose Create custom action.


Make a note of the Custom action ARN. You need to use the ARN when you create a rule to associate with this action in CloudWatch Events.


Creating a custom action (Security Hub API, AWS CLI)
To create a custom action, you can use an API call or the AWS Command Line Interface.
To create a custom action (Security Hub API, AWS CLI)
 Security Hub API – Use the https://docs.aws.amazon.com/securityhub/1.0/APIReference/API_CreateActionTarget.html operation. When you create a custom action, you provide the name, description, and custom action identifier.
 AWS CLI – At the command line, run the https://docs.aws.amazon.com/cli/latest/reference/securityhub/create-action-target.html command.
create-action-target --name <customActionName> --description <customActionDescription> --id <customActionidentifier>
Example
aws securityhub create-action-target --name "Send to remediation" --description "Action to send the finding for remediation tracking" --id "Remediation"
Defining a rule in CloudWatch Events
To process the custom action, you must create a corresponding rule in CloudWatch Events. The rule definition includes the ARN of the custom action.
To define a rule in CloudWatch Events


Open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.


In the navigation pane, choose Rules.


Choose Create rule.


For Event source, confirm that Event Pattern is selected.


Choose Edit for Event Pattern Preview.


Copy one of the following example patterns, and paste it into the preview window. Be sure to replace the existing brackets.


For an event associated with a finding custom action (Security Hub Findings - Custom Action event type), use the following format. Replace the placeholder ARN with the Custom Action ARN for the custom action you created.
{
     "source": [
       "aws.securityhub"
     ],
     "detail-type": [
       "Security Hub Findings - Custom Action"
     ],
     "resources": [
       "arn:aws:securityhub:us-west-2:123456789012:action/custom/test-action1"
     ]
   }
For an event associated with an insight custom action (Security Hub Insight Results event type), use the following format. Replace the placeholder ARN with the Custom Action ARN for the custom action you created.
{
     "source": [
       "aws.securityhub"
     ],
     "detail-type": [
       "Security Hub Insight Results"
     ],
     "resources": [
       "arn:aws:securityhub:us-west-2:123456789012:action/custom/test-action1"
     ]
   }


Choose Save to close the window.


Choose Add target and then select the target to invoke when this rule is matched.


Choose Configure details.


Enter a name and description for the rule.


To enable the rule now, for State, select Enabled. To save the rule without enabling it, clear Enabled.

Choose Create rule.

After this rule is created in CloudWatch Events, when you perform a custom action on findings or insight results in your account, events are generated in CloudWatch Events.
Selecting a custom action for findings and insight results
After you create your Security Hub custom actions and CloudWatch Events rules, you can send findings and insight results to CloudWatch Events for further management and processing.
Events are sent to CloudWatch Events only in the account in which they are viewed. If you view a finding using a master account, the event is sent to CloudWatch Events in the master account.
For AWS API calls to be effective, the implementations of target code must switch roles into member accounts. This also means that the role you must switch into must be deployed to each member where action is needed.
To send findings to CloudWatch Events


Open the AWS Security Hub console at https://console.aws.amazon.com/securityhub/.


Display a list of findings:
    From Findings, you can view findings from all of the enabled product integrations and controls.
    From Security standards, you can navigate to a list of findings generated from a selected control. See Viewing details for a control.
    From Integrations, you can navigate to a list of findings generated by an enabled integration. See Viewing the findings from an integration.
    From Insights, you can navigate to a list of findings for an insight result. See Viewing and taking action on insight results and findings.


Select the findings to send to CloudWatch Events. You can select up to 20 findings at a time.


From Actions, choose the custom action that aligns with the CloudWatch Events rule to apply.


To send insight results to CloudWatch Events


Open the AWS Security Hub console at https://console.aws.amazon.com/securityhub/.


In the navigation pane, choose Insights.


On the Insights page, choose the insight that includes the results to send to CloudWatch Events.


Select the insight results to send to CloudWatch Events. You can select up to 20 results at a time.


From Actions, choose the custom action that aligns with the CloudWatch Events rule to apply.

