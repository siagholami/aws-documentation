Installing the Amazon ECS Container Agent
If your container instance was not launched using an Amazon ECS-optimized AMI, you can install the Amazon ECS container agent manually using one of the following procedures. The Amazon ECS container agent is included in the Amazon ECS-optimized AMIs and does not require installation.
 For Amazon Linux 2 instances, you can install the agent using the amazon-linux-extras command. For more information, see Installing the Amazon ECS Container Agent on an Amazon Linux 2 EC2 Instance.
 For Amazon Linux AMI instances, you can install the agent using the Amazon YUM repo. For more information, see Installing the Amazon ECS Container Agent on an Amazon Linux AMI EC2 Instance.
 For non-Amazon Linux instances, you can either download the agent from one of the regional S3 buckets or from Docker Hub. If you download from one of the regional S3 buckets, you can optionally verify the validity of the container agent file using the PGP signature. For more information, see Installing the Amazon ECS Container Agent on a non-Amazon Linux EC2 Instance
Note
The systemd units for both ECS and Docker services have a directive to wait for cloud-init to finish before starting both services. The cloud-init process is not considered finished until your Amazon EC2 user data has finished running. Therefore, starting ECS or Docker via Amazon EC2 user data may cause a deadlock. To start the container agent using Amazon EC2 user data you can use systemctl enable --now --no-block ecs.service.
Installing the Amazon ECS Container Agent on an Amazon Linux 2 EC2 Instance
To install the Amazon ECS container agent on an Amazon Linux 2 EC2 instance using the amazon-linux-extras command, use the following steps.
To install the Amazon ECS container agent on an Amazon Linux 2 EC2 instance


Launch an Amazon Linux 2 EC2 instance with an IAM role that allows access to Amazon ECS. For more information, see Amazon ECS Container Instance IAM Role.


Connect to your instance.


Disable the docker Amazon Linux extra repository. The ecs Amazon Linux extra repository ships with its own version of Docker, so the docker extra must be disabled to avoid any potential future conflicts. This ensures that you are always using the Docker version that Amazon ECS intends for you to use with a particular version of the container agent.


[ec2-user ~]$ sudo amazon-linux-extras disable docker

Install and enable the ecs Amazon Linux extra repository.

[ec2-user ~]$ sudo amazon-linux-extras install -y ecs; sudo systemctl enable --now ecs

(Optional) You can verify that the agent is running and see some information about your new container instance with the agent introspection API. For more information, see Amazon ECS Container Agent Introspection.

[ec2-user ~]$ curl -s http://localhost:51678/v1/metadata | python -mjson.tool
Note
If you get no response, ensure that you associated the Amazon ECS container instance IAM role when launching the instance. For more information, see Amazon ECS Container Instance IAM Role.
Installing the Amazon ECS Container Agent on an Amazon Linux AMI EC2 Instance
To install the Amazon ECS container agent on an Amazon Linux AMI EC2 instance using the Amazon YUM repo, use the following steps.
To install the Amazon ECS container agent on an Amazon Linux AMI EC2 instance


Launch an Amazon Linux AMI EC2 instance with an IAM role that allows access to Amazon ECS. For more information, see Amazon ECS Container Instance IAM Role.


Connect to your instance.


Install the ecs-init package. For more information about ecs-init, see the source code on GitHub.


[ec2-user ~]$ sudo yum install -y ecs-init

Start the Docker daemon.

[ec2-user ~]$ sudo service docker start
Output:
Starting cgconfig service:                                 [  OK  ]
   Starting docker:                                    [  OK  ]

Start the ecs-init upstart job.

[ec2-user ~]$ sudo start ecs
Output:
ecs start/running, process 2804

(Optional) You can verify that the agent is running and see some information about your new container instance with the agent introspection API. For more information, see Amazon ECS Container Agent Introspection.

[ec2-user ~]$ curl -s http://localhost:51678/v1/metadata | python -mjson.tool
Installing the Amazon ECS Container Agent on a non-Amazon Linux EC2 Instance
To install the Amazon ECS container agent on a non-Amazon Linux EC2 instance, you can either download the agent from one of the regional S3 buckets or from Docker Hub. If you download from one of the regional S3 buckets, you can optionally verify the validity of the container agent file using the PGP signature.
The latest Amazon ECS container agent files, by Region, are listed below for reference.



Region
Region Name
Container agent
Container agent signature




us-east-2
US East (Ohio)
ECS container agent
PGP signature


us-east-1
US East (N. Virginia)
ECS container agent
PGP signature


us-west-1
US West (N. California)
ECS container agent
PGP signature


us-west-2
US West (Oregon)
ECS container agent
PGP signature


ap-east-1
Asia Pacific (Hong Kong)
ECS container agent
PGP signature


ap-northeast-1
Asia Pacific (Tokyo)
ECS container agent
PGP signature


ap-northeast-2
Asia Pacific (Seoul)
ECS container agent
PGP signature


ap-south-1
Asia Pacific (Mumbai)
ECS container agent
PGP signature


ap-southeast-1
Asia Pacific (Singapore)
ECS container agent
PGP signature


ap-southeast-2
Asia Pacific (Sydney)
ECS container agent
PGP signature


ca-central-1
Canada (Central)
ECS container agent
PGP signature


eu-central-1
Europe (Frankfurt)
ECS container agent
PGP signature


eu-west-1
Europe (Ireland)
ECS container agent
PGP signature


eu-west-2
Europe (London)
ECS container agent
PGP signature


eu-west-3
Europe (Paris)
ECS container agent
PGP signature


sa-east-1
South America (SÃ£o Paulo)
ECS container agent
PGP signature


us-gov-east-1
AWS GovCloud (US-East)
ECS container agent
PGP signature


us-gov-west-1
AWS GovCloud (US-West)
ECS container agent
PGP signature



To install the Amazon ECS container agent on a non-Amazon Linux EC2 instance


Launch an Amazon EC2 instance with an IAM role that allows access to Amazon ECS. For more information, see Amazon ECS Container Instance IAM Role.


Connect to your instance.


Install the latest version of Docker on your instance.
Note
The Amazon Linux AMI always includes the recommended version of Docker for use with Amazon ECS. You can install Docker on Amazon Linux with the sudo yum install docker -y command.


Check your Docker version to verify that your system meets the minimum version requirement.


ubuntu:~$ sudo docker version
Output:
Client version: 1.4.1
   Client API version: 1.16
   Go version (client): go1.3.3
   Git commit (client): 5bc2ff8
   OS/Arch (client): linux/amd64
   Server version: 1.4.1
   Server API version: 1.16
   Go version (server): go1.3.3
   Git commit (server): 5bc2ff8
In this example, the Docker version is 1.4.1, which is below the minimum version of 1.9.0. This instance needs to upgrade its Docker version before proceeding. For information about installing the latest Docker version on your particular Linux distribution, go to https://docs.docker.com/engine/installation/.

Run the following commands on your container instance to allow the port proxy to route traffic using loopback addresses.

ubuntu:~$ sudo sh -c "echo 'net.ipv4.conf.all.route_localnet = 1' >> /etc/sysctl.conf"
   ubuntu:~$ sudo sysctl -p /etc/sysctl.conf

Run the following commands on your container instance to enable IAM roles for tasks. For more information, see IAM Roles for Tasks.

ubuntu:~$ sudo apt-get install iptables-persistent
   ubuntu:~$ sudo iptables -t nat -A PREROUTING -p tcp -d 169.254.170.2 --dport 80 -j DNAT --to-destination 127.0.0.1:51679
   ubuntu:~$ sudo iptables -t nat -A OUTPUT -d 169.254.170.2 -p tcp -m tcp --dport 80 -j REDIRECT --to-ports 51679


Write the new iptables configuration to your operating system-specific location.
    For Debian/Ubuntu: 
sudo sh -c 'iptables-save > /etc/iptables/rules.v4'
    For CentOS/RHEL: 
sudo sh -c 'iptables-save > /etc/sysconfig/iptables'


Create the /etc/ecs directory and create the Amazon ECS container agent configuration file.


ubuntu:~$ sudo mkdir -p /etc/ecs && sudo touch /etc/ecs/ecs.config

Edit the /etc/ecs/ecs.config file and add the following contents. If you do not want your container instance to register with the default cluster, specify your cluster name as the value for ECS_CLUSTER.

ECS_DATADIR=/data
   ECS_ENABLE_TASK_IAM_ROLE=true
   ECS_ENABLE_TASK_IAM_ROLE_NETWORK_HOST=true
   ECS_LOGFILE=/log/ecs-agent.log
   ECS_AVAILABLE_LOGGING_DRIVERS=["json-file","awslogs"]
   ECS_LOGLEVEL=info
   ECS_CLUSTER=default
For more information about these and other agent runtime options, see Amazon ECS Container Agent Configuration. 
Note
You can optionally store your agent environment variables in Amazon S3 (which can be downloaded to your container instances at launch time using Amazon EC2 user data). This is recommended for sensitive information such as authentication credentials for private repositories. For more information, see Storing Container Instance Configuration in Amazon S3 and Private registry authentication for tasks.

Pull and run the latest Amazon ECS container agent on your container instance.
Note
Use Docker restart policies or a process manager (such as upstart or systemd) to treat the container agent as a service or a daemon and ensure that it is restarted after exiting. For more information, see Automatically start containers and Restart policies in the Docker documentation. The Linux variants of the Amazon ECS-optimized AMI use the ecs-init RPM for this purpose, and you can view the source code for this RPM on GitHub. For example systemd unit files for Ubuntu 16.04 and CentOS 7, see Example Container Instance User Data Configuration Scripts.

The following example of the agent run command is broken into separate lines to show each option. For more information about these and other agent runtime options, see Amazon ECS Container Agent Configuration.
Important
Operating systems with SELinux enabled require the --privileged option in your docker run command. In addition, for SELinux-enabled container instances, we recommend that you add the :Z option to the /log and /data volume mounts. However, the host mounts for these volumes must exist before you run the command or you receive a no such file or directory error. Take the following action if you experience difficulty running the Amazon ECS agent on an SELinux-enabled container instance:
Create the host volume mount points on your container instance.  
 ```
 ubuntu:~$ sudo mkdir -p /var/log/ecs /var/lib/ecs/data
 ```

Add the --privileged option to the docker run command below.
Append the :Z option to the /log and /data container volume mounts (for example, --volume=/var/log/ecs/:/log:Z) to the docker run command below.


(Optional) Download the ECS container agent tarball from the regional S3 URL and load it. If you don't download the agent tarball from S3, the docker run command in the next step will download it from Docker Hub for you automatically.
ubuntu:~$ curl -o ecs-agent.tar https://s3.amazonaws.com/amazon-ecs-agent-us-east-1/ecs-agent-latest.tar
Note
To download other versions of the Amazon ECS container agent, use one of the following formats, changing the version number in the URL:  
ecs-agent-<version>.tar
  ecs-agent-<SHA>.tar
For example:  
https://s3.amazonaws.com/amazon-ecs-agent-us-east-1/ecs-agent-v1.18.0.tar
  https://s3.amazonaws.com/amazon-ecs-agent-us-east-1/ecs-agent-c0defea9.tar
Load the ECS container agent image.
ubuntu:~$ sudo docker load --input ./ecs-agent.tar


Run the ECS container agent image.
ubuntu:~$ sudo docker run --name ecs-agent \
  --detach=true \
  --restart=on-failure:10 \
  --volume=/var/run:/var/run \
  --volume=/var/log/ecs/:/log \
  --volume=/var/lib/ecs/data:/data \
  --volume=/etc/ecs:/etc/ecs \
  --net=host \
  --env-file=/etc/ecs/ecs.config \
  amazon/amazon-ecs-agent:latest
Important
The host network mode is the only supported network mode for the container agent container. For more information, see Running the Amazon ECS Container Agent with Host Network Mode.
Note
If you receive an Error response from daemon: Cannot start container message, you can delete the failed container with the sudo docker rm ecs-agent command and try running the agent again. 


(Optional) If you downloaded the Amazon ECS container agent file from S3, you can verify the validity of the file.


Download and install GnuPG. For more information about GNUpg, see the GnuPG website. For Linux systems, install gpg using the package manager on your flavor of Linux.


Retrieve the Amazon ECS PGP public key. You can use a command to do this or manually create the key and then import it.


Option 1: Retrieve the key with the following command.
gpg --keyserver hkp://keys.gnupg.net --recv BCE9D9A42D51784F


Option 2: Create a file with the following contents of the Amazon ECS PGP public key and then import it:
```
 -----BEGIN PGP PUBLIC KEY BLOCK-----
 Version: GnuPG v2
mQINBFq1SasBEADliGcT1NVJ1ydfN8DqebYYe9ne3dt6jqKFmKowLmm6LLGJe7HU
 jGtqhCWRDkNqPpHqdArRgDZAtn2pXY5fEipHgar4CP8QgRnRMO2fl74lmavr4Vg
 7K/KH8VHlq2uRw32/B94XLEgRbGTMdWFdKuxoPCttBQaMj3LGn6Pe6xVWRkChQu
 BoQAhjBQbEm0kNy0LjNgjNlnL3UMAG56t8E3LANIgGgEnpNsB1UwfWluPoGZoTx
 N6pHBJrKIL/1v/ETU4FXpYw2zvhWNahxeNRnoYj3uycHkeliCrw4kj0skizBgO
 2K7oVX8Oc3j5ZilhL/qDLXmUCb2az5cMM1mOoF8EKX5HaNuq1KfwJxqXE6NNIcO
 lFTrT7QwD5fMNld3FanLgv/ZnIrsSaqJOL6zRSq8O4LN1OWBVbndExk2Kr5kFxn
 5lBPgfPgRj5hQKTHMa9Y8Z7yUc64BJiN6F9Nl7FJuSsfqbdkvRLsQRbcBG9qxX3
 rJAEhieJzVMEUNlEgeCkxj5xuSkNU7zw2c3hQZqEcrADLVhvFJktOz9Gm6xzbq
 lTnWWCz4xrIWtuEBA2qEMlDheVd78a3gIsEaSTfQq0osYXaQbvlnSWOoc1y/5Zb
 zizHTJIhLtUyls9WisP2s0emeHZicVMfW61EgPrJAiupgc7kyZvFt4YwfwARAQAB
 tCRBbWF6b24gRUNTIDxlY3Mtc2VjdXJpdHlAYW1hem9uLmNvbT6JAhwEEAECAAYF
 AlrjL0YACgkQHivRXs0TaQrg1g/JppwPqHnlVPmv7lessB8I5UqZeD6p6uVpHd7
 Bs3pcPp8BV7BdRbs3sPLt5bV1rkqOlw0gZ4Q/ue/YbWtOAt4qY0OcEo0HgcnaX
 lsB827QIfZIVtGWMhuh94xzm/SJkvngml6KB3YJNnWP61A9qJ37/VbVVLzvcmazA
 McWB4HUMNrhd0JgBCo0gIpqCbpJEvUc02Bjn23eEJsS9kC7OUAHyQkVnx4d9UzXF
 4OoISF6hmQKIBoLnRrAlj5Qvs3GhvHQ0ThYq0Grk/KMJJX2CSqt7tWJ8gk1n3H3Y
 SReRXJRnv7DsDDBwFgT6r5Q2HW1TBUvaoZy5hF6maD09nHcNnvBjqADzeT8Tr/Qu
 bBCLzkNSYqqkpgtwv7seoD2P4n1giRvDAOEfMZpVkUrC252IaH1HZFEzTvBVQM
 Y8OWWxmIJWJ6evjo3N1eO19UHv71jvoF8zljbI4bsL2cQTJmOv7nRqzDQgCWyp
 Id/v2dUVVTk1j9omuLBBwNJzQCB72LcIzJhYmaP1HC4LcKQG/f41exuItenatK
 lEJQhYtyVXcBlh6Yn/wzNg2NWOwb3vqY/F7m6u9ixAwgtIMgPCDE4aJ86zrrXYFz
 N2HqkTSQh77Z8KPKmyGopsmN/reMuilPdINb249nA0dzoNnjtTFOYCIaLaFyjs
 Z0r1QAOJAjkEEwECACMFAlq1SasCGwMHCwkIBwMCAQYVCAIJCgsEFgIDAQIeAQIX
 gAAKCRC86dmkLVF4T9iFEACEnkm1dNXsWUx34R3c0vamHrPxvfkyI1FlEUen8D1h
 uX9xy6jCEROHWEp0rjGK4QDPgM93sWJs1UAKg214QRVzft0y9/DdRtwApA0fzy
 uavIthGd603jAAo6udYDEcZC3P7XBbDiYEWk4XAF9I1JjB8hTZUgvXBL046JhG
 eM17crgUyQeetkiOQemLbsbXQ40Bd9V7zf7XJraFd8VrwNUwNb9KFtgAsc9rk
 YIT/PEfYOPysgcxI4sTWghtyCulVnuGoskgDv4v73PALU0ieUrvvQVqWMRvhVx1
 0X90J7cC1KOyhlEQQ1aFTgmQjmXexVTwIBm8LvysFK6YXM41KjOrlz36xBIm/qe
 bFyLUnf4WoiuOplAaJhK9pRYXEnGNxdtN4D26Kd0FPLkm3Tr3Hy3b1Ok34FlGr
 KVHUq1TZD7cvMnnNKEELTUcKX1mV3an16nmAg/my1JSUt6BNK2rJpY1s/kkSGSE
 XQ4zuF2IGCpvBFhYAlt5Un5zwqkwwQR3/n2kwAoDzonJcehDw/C/cGos5D0aIU7I
 K2X2aTD3pA7Mx3IMe2hqmYqRt9X42yF1PIEVRneBRJ3HDezAgJrNh0GQWRQkhIx
 gz6/cTRekr5TptVszS9few2GpI5bCgBKBisZIssT89aw7mAKWut0Gcm4qM9/yK6
 1bkCDQRatUmrARAAxNPvVwreJ2yAiFcUpdRlVhsuOgnxvs1QgsIw3H7Pacr9Hpe
 8uftYZqdC82KeSKhpHq7c8gMTMucIINtH25x9BCc73E33EjCL9Lqov1TL7QkgHe
 TJIhZwdD8Mx2KLVVVu/aWkNrfMuNwyDUciSI4D5QHa8TF8fgN4OTpwYjirzel
 5yoICMr9hVcbzDNv/ozKCxjxXKgnFc3wrnDfJfntfDAT7ecwbUTLviQKJ646s
 psiqXRYtVvYInEhLVrJ0aV6zHFoigE/Bils6/g7ru1Q6CEHqEwAPs5CcE8VzJu
 WAGSVHZgun5Y9N4quR/M9VmIPMhTxrAg7rOvyRN9cAXfeSMf77IXTifigNna8x
 t/MOdjXr1fjF4pThEi5u6WsuRdFwjY2azEv3vevodTi4HoJReH6dFRa6y8cUDgl
 2iHiOKIpQqLbHEfQmHcDd2fixAaJKMnPGNku9qCFEMbgSRJpXz6BfwnY1QuKEI
 R6jA0frUNt2jhiGG/F8RceXzohaaC/Cx7LUCUFWc0n7z32C9/Dtj7I1PMOacdZzz
 bjJzRKO/ZDvUN/c9dwAkllzAyPMwGBkUaY68EBstnIliW34aWm6IiHhxioVPKSp
 VJfyiXPO0EXqujtHLAeChfjcns3I12YshT1dv2PafG53fp33ZdzeUgsBoEAEQEA
 AYkCHwQYAQIACQUCWrVJqwIbDAAKCRC86dmkLVF4TZdD/9x/8APzgNJF3o3STrF
 jvnV1ycyhWYGAeBJiu7wjsNWwzMFOv15tLjB7AqeVxZnWKDD/mIOQ45OZvnYZuy
 X7DR0JszaH9wrYTxZLVruAut6UL0y/XQ4L1GZ9QR6r7t1Mvbfy7BlHbvX/gYt
 Rwe/uwdibI0CagEzyX2D3kTOlHO5XThbXaNf8AN8zha91Jt2Q2UR2X5T6JcwtMz
 FBvZnl3LSmZyE0EQehS2iUurU4uWOpGppuqVnbi0jbCvCHKgDGrqZ0smKNAQng54
 F365W3g8AfY48s8XQwzmcliowYX9bT8PZiEi0J4QmQh0aXkpqZyFefuWeOL2R94S
 XKzrgRh3BAULoqFqKIUMxTip9KTPNvYDpiC66yBiT6gFDji5Ca9pGpJXrC3xe
 TXiKQ8DBWDhBPVPrruLIaenTtZEOsPc4I85yt5U9RoPTStcOr34s3w5yEaJagt6S
 Gc5r9ysjkfH66rbi1ujxMgROSqtqrRyBV9A5/OgtNZc8llK6u4UoOCde8jUUW
 vqWKvjJB/Kz3u4zaeNu2ZyyHaOqOuHTETcWjsY9IhbEzqN5yQYGi4pVmDkY5vu
 lXbJnbqPKpRXgM9BecV9AMbPgbDq/5LnHJJXgG8YQOgp4lR/hC1TEFdIp5wM8AK
 CWsENyt2o1rjgMXiZOMF8A5oBLkCDQRatUuSARAAr77kj7j2QR2SZeOSlFBvV7oS
 mFeSNnz9xZssqrsm6bTwSHM6YLDwc7Sdf2esDdyzONETwqrVCgFxgL8hmo9hS4c
 rR6tmrP0mOmptrxLLsKcaP7ogIXsyZnrEAEsvW8PnfayoiPCdc3cMCR/lTnHFGA
 7EuR/XLBmi7Qg9tByVYQ5Yj5wB9V4B2yeCt3XtzPqeLKvaxl7PNelaHGJQY/xom
 V0bndxf9IY4oFJ4blD32WqvyxESo7vW6WBh7oqv3Zbm0yQrr8a6mDBpqLkvWwNI
 3kpJR974tg5o5LfDu1BeeyHWPSGm4U/G4JBJIG1ADyRmoWEt4BqTCZ/knnoGvw
 D5sTCxbKdmuOmhGyTssoG3OOcGYHV7pWYPhazKHMPm201xKCjH1RfzRULzGKjD
 yMLT1I3AXFmLmZJXikAOlvE3/wgMqCXscbycbLjLD/bXIuFWo3rzoezeXjgi/DJx
 jKBAyBTYO5nMcth1O9oaFd9d0HbsOUDkIMnsgGBE766Piro6MHo0T0rXl07Tp4pI
 rwuSOsc6XzCzdImj0Wc6axS/HeUKRXWdXJwno5awTwXKRJMXGfhCvSvbcbc2WxL
 IKvmB7EB4K3fmjFFE67yolmiw2qRcUBfygtH3eL5XZU28MiCpue8Y8GKJoBAUyvf
 KeM1rO8Jm3iRAc5a/D0AEQEAAYkEPgQYAQIACQUCWrVLkgIbAgIpCRC86dmkLVF4
 T8FdIAQZAQIABgUCWrVLkgAKCRDePL1hraLjtHYD/9MucxdFe6bXO1dQR4tKhhQ
 P0LRqy6zlBY9ILCLowNdGZdqorogUiUymgn3VhEhVtxTOoHcN7qOuM01PNsRnOeS
 EYjf8Xrb1clzkD6xULwmOclTb9bBxnBc/4PFvHAbZW3QzusaZniNgkuxt6BTfloS
 Of4inq71kjmGKTlzQ6mUMQUg228NUQCa84EPqYyAeY1sgvgB7hJBhYL0QAxhcW
 6m20Rd8iEc6HyzJ3yCOCsKip/nRWAbf0OvfHfRBp0m0ZwnJM8cPRFjOqqzFpKH9
 HpDmTrC4wKP1TL52LyEqNh4yZitXmZNV7giSRIkk0eDSkobFy6VbMzKUMkUJK3
 D3eHFAMkujmbfJmSMTJOPGn5SB1HyjCZNx6bhIIbQyEUB9gKCmUFaqXKwKpF6rj0
 iQXAJxLR/shZ5Rk96VxzOphUl7T90m/PnUEEPwq8KsBhnMRgxa0RFidDPn9fgtv
 HLmrOqX9zBCVXh0mdWYLrWvmzQFWzG7AoE55fkf8nAEPsalrCdtaNUBHRXA0OQxG
 AHMOdJQQvBsmqMvuAdjkDWpFu5y0My5ddUhiUzUyQLjL5Hhd5LOUDdewlZgIw1j
 xrEAUzDKetnemM8GkHxDgg8koev5frmShJuce7vSjKpCNg3EIJSgqMOPFjJuLWtZ
 vjHeDNbJy6uNL65ckJy6WhGjEADS2WAW1D6Tfekkc21SsIXk/LqEpLMR/0g5OUif
 wcEN1rS9IJXBwIy8MelN9qr5KcKQLmfdfBNEyyceBhyVl0MDyHOKC7PofMtkGBq
 13QieRHv5GJ8LB3fclqHV8pwTTo3Bc8z2g0TjmUYAN/ixETdReDoKavWJYSE9yoM
 aaJu279ioVTrwpECse0XkiRyKToTjwOb73CGkBZZpJyqux/rmCV/fp4ALdSW8zbz
 FJVORaivhoWwzjpfQKhwcU9lABXi2UvVm14v0AfeI7oiJPSU1zM4fEny4oiIBXlR
 zhFNih1UjIu82X16mTm3BwbIga/s1fnQRGzyhqUIMiimWra23EwjChaxpvjjcUH
 5ilLc5Zq781aCYRygYQwhu5nFkOH1RZ50Ubxjd/aqUfnGIAX7kPMD3Lof4KldD
 Q8ppQriUvxVo4nPV6rpTy/PyqCLWDjkguHpJsEFsMkwajrAz0QNSAU5CJ0G2Zu4
 yxvYlumHCEl7nbFrm0vIiA75Sa8KnywTDsyZsu3XcOcf3gg1xWTpjJqy2bYXlqz
 9uDOWtArWHOis6bq8l9RE6xr1RBVXS6uqgQIZFBGyq66b0dIq4D2JdsUvgEMaHbc
 e7tBfeB1CMBdA64e9Rq7bFR7Tvt8gasCZYlNr3lydhdFHIEkH53HzQe6l88HEic
 0jVnLkCDQRa55wJARAAyLya2Lx6gyoWoJN1a6740q3o8e9d4KggQOfGMTCflmeq
 ivuzgN3DZHN9ty2KxXMtn0mhHBerZdbNJyjMNT1gAgrhPNB4HtXBXum2wS57WK
 DNmade914L7FWTPAWBG2Wn448OEHTqsClICXXWy9IICgclAEyIq0Yq5mAdTEgRJS
 Z8t4GpwtDL9gNQyFXaWQmDmkAsCygQMvhAlmu9xOIzQG5CxSnZFk7zcuL60k14Z3
 Cmt49k4T/7ZU8goWi8ttrU78/IL3J/fF91civ1OwuUidgfPCSvOUW1JojsdCQA
 LRZJcoXq7lfOFj/eNjeOSstCTDPfTCLkThE6E5neDtbQHBYkEX1BRiTedsV4M
 ucgiTrdQFWKf89G72xdv8ut9AYYQ2BbEYUJAYhUH8rYYui2dHKJIgjNvJscuUWb
 QEqJIRleJRhrO/CHgMs4fZAkWF1VFhKBkcKmEjLn1f7EJJUUW84ZhKXjO/AUPX
 1CHsNjziRceuJCJYox1cwsoq6jTE50GiNzcIxTn9xUc0UMKFeggNAFys1KTDTm3
 Bzo8H5ucjCUEmUm9lhkGwqTZgOlRX5eqPXJBoSaObqhgqCa5IPinKRa6MgoFPHK
 6sYKqroYwBGgZm6Js5chpNchvJMs/3WXNOEVg0J3z3vP0DMhxqWmrn9zlW8qsA
 EQEAAYkEPgQYAQgACQUCWuecCQIbAgIpCRC86dmkLVF4T8FdIAQZAQgABgUCWuec
 CQAKCRBQ3szEcQ5hrykD/4tOLRHFHXuKUcxgGaubUcVtsFrwBKma1cYjqaPms8u
 6Sk0wfGRI32G/GhOrp0Ts/MOkbObq6VLTh8N5Yc/53MEl8zQFw9Y5AmRoW4PZXER
 ujs5s7p4oR7xHMihMjCCBn1bvrR34YPfgzTcgLiOEFHYT8UTxwnGmXOvNkMM7md
 xD3CV5q6VAte8WKBo/220II3fcQlc9r/oWX4kXXkb0v9hoGwKbDJ1tzqTPrp/xFt
 yohqnvImpnlzQ9zXmbrWYL9/g8VCmW/NN2gju2G3Lu/TlFUWIT4v/5OPK6TdeNb
 VKJO4S8bTayqSG9CML1S57KSgCo5HUhQWeSNHIfpe5oX6FALPT9JLDce8OZz1i
 cZZ0MELP37mOOQun0AlmHm/hVzf0f311PtbzcqWaE51tJvgUR/nZFo6Ta3O5Ezhs
 3VlEJNQ1Ijf/6DH87SxvAoRIARCuZd0qxBcDK0avpFzUtbJd24lRA3WJpkEiMqKv
 RDVZkE4b6TW61f0oLaVfK6E8oLpixegS4fiqC16mFrOdyRkRJJfIUyz0WTDVmt
 g0U1CO1ezokMSqkJ7724pyjr2xf/r9/sC6aOJwB/lKgZkJfC6NqL7TlxVA31dUga
 LEOvEJTTE4gltYtfsCDvALCtqL0jduSkUoRXcBItmXhAtShW0pbS2Rtx/ixua
 KohVD/0R4QxiSwQmICNtm9mw9ydIl1yjYXX5a9x4wMJracNY/LBybJPFnZnT4dYR
 z4XjqysDwvvYZByaWoIe3QxjX84V6MlI2IdAT/xImu8gbaCI8tmyfpIrLnPKiR9D
 VFYfGBXuAX7HgPPSFtrHQONCALxxzlbNpSzxt9r0MiLgcLyspWxSdmoYGZ6nQP
 RO5Nm/ZVSu2imPCRzNUZEMadlE6kHx0rS0dPiuJ4O7NtPeYDKkoQtNagspsDvh
 cK7CSqAiKMq06UBTxqlTSRkm62eOCtcs3p3OeHu5GRZF1uzTET0ZxYkaPgdrQknx
 ozjP5mC7X45lcCfmcVt94TFNL5HwEUVJpmOgmzILCI8yoDTWzlooifPFsXX4f
 kynhE83mSEcr5VHFYrTY3mQXGmNJ3bCLuc/jq7ysGq69xiKmTlUeXFmaojcRO5i
 zyShIRJZ0GZfuzDYFDbMV9amA/YQGygLw//zP5ju5SW26dNxlf3MdFQE5JJ86rn9
 MgZ4gcpazHEVUsbZsgkLizRp9imUiH8ymLqAXnfRGlU/LpNSefnvDFTtEIRcpOHc
 bhayG0bk51Bd4mioOXnIsKy4j63nJXA27x5EVVHQ1sYRN8Ny4Fdr2tMAmj2OXJ
 qX2yy/UX5nSPU492e2CdZ1UhoU0SRFY3bxKHKB7SDbVeavK5g==
 =Gi5D
 -----END PGP PUBLIC KEY BLOCK-----
 ```
The details of the Amazon ECS PGP public key for reference:
Key ID: BCE9D9A42D51784F
 Type: RSA
 Size: 4096/4096
 Expires: Never
 User ID: Amazon ECS
 Key fingerprint: F34C 3DDA E729 26B0 79BE AEC6 BCE9 D9A4 2D51 784F
Import the Amazon ECS PGP public key with the following command.
gpg --import <public_key_filename>




Download the ECS container agent signature. ECS container agent signatures are ascii detached PGP signatures stored in files with the extension .asc. The signatures file has the same name as its corresponding executable, with .asc appended.
curl -o ecs-agent.asc https://s3.amazonaws.com/amazon-ecs-agent-us-east-1/ecs-agent-latest.tar.asc


Verify the signature.
gpg --verify ecs-agent.asc ./ecs-agent.tar
Expected output:
gpg: Signature made Wed 16 May 2018 08:21:06 PM UTC using RSA key ID 710E61AF
  gpg: Good signature from "Amazon ECS <ecs-security@amazon.com>" [unknown]
  gpg: WARNING: This key is not certified with a trusted signature!
  gpg:          There is no indication that the signature belongs to the owner.
  Primary key fingerprint: F34C 3DDA E729 26B0 79BE  AEC6 BCE9 D9A4 2D51 784F
       Subkey fingerprint: D64B B6F9 0CF3 77E9 B5FB  346F 50DE CCC4 710E 61AF
Note
The warning in the output is expected and is not problematic; it occurs because there is not a chain of trust between your personal PGP key (if you have one) and the Amazon ECS PGP key. For more information, see Web of trust.


Running the Amazon ECS Container Agent with Host Network Mode
When running the Amazon ECS container agent, ecs-init will create the container agent container with the host network mode. This is the only supported network mode for the container agent container. 
This enables you to block access to the Amazon EC2 instance metadata service endpoint (http://169.254.169.254) for the containers started by the container agent. This ensures that containers cannot access IAM role credentials from the container instance profile and enforces that tasks use only the IAM task role credentials. For more information, see IAM Roles for Tasks.
This also makes it so the container agent doesn't contend for connections and network traffic on the docker0 bridge.