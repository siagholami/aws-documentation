Step 1: Set Up the Prerequisites
To set up web server SSL/TLS offload with AWS CloudHSM, you need the following:
 An active AWS CloudHSM cluster with at least one HSM.
 An Amazon EC2 instance running a Windows operating system with the following software installed:
   The AWS CloudHSM client software for Windows.
   Internet Information Services (IIS) for Windows Server.
 A crypto user (CU) to own and manage the web server's private key on the HSM.
Note
This tutorial uses Microsoft Windows Server 2016. Microsoft Windows Server 2012 is also supported, but Microsoft Windows Server 2012 R2 is not.
To set up a Windows Server instance and create a CU on the HSM


Complete the steps in Getting Started. When you launch the Amazon EC2 client, choose a Windows Server 2016 or Windows Server 2012 AMI. When you complete these steps, you have an active cluster with at least one HSM. You also have an Amazon EC2 client instance running Windows Server with the AWS CloudHSM client software for Windows installed.


(Optional) Add more HSMs to your cluster. For more information, see Adding an HSM.


Connect to your Windows server. For more information, see Connect to Your Instance in the Amazon EC2 User Guide for Windows Instances.


To create a cryptographic user (CU) on your HSM, do the following:


Start the AWS CloudHSM client.


Update the cloudhsm_mgmt_util configuration file.


Start cloudhsm_mgmt_util.


Enable end-to-end encryption.


Log in to the HSMs with the user name and password of a crypto officer (CO).


Create a crypto user (CU). Keep track of the CU user name and password. You will need them to complete the next step.


Set the login credentials for the HSM, using the CU user name and password that you created in the previous step.


In step 5, if you used Windows Credentials Manager to set HSM credentials, download https://live.sysinternals.com/psexec.exe from SysInternals to run the following command as NT Authority\SYSTEM:


psexec.exe -s "C:\Program Files\Amazon\CloudHsm\tools\set_cloudhsm_credentials.exe" --username <username> --password <password>
Replace  and  with the HSM credentials.
To install IIS on your Windows Server


If you haven't already done so, connect to your Windows server. For more information, see Connect to Your Instance in the Amazon EC2 User Guide for Windows Instances.


On your Windows server, start Server Manager.


In the Server Manager dashboard, choose Add roles and features.


Read the Before you begin information, and then choose Next.


For Installation Type, choose Role-based or feature-based installation. Then choose Next.


For Server Selection, choose Select a server from the server pool. Then choose Next.


For Server Roles, do the following:


Select Web Server (IIS).


For Add features that are required for Web Server (IIS), choose Add Features.


Choose Next to finish selecting server roles.


For Features, accept the defaults. Then choose Next.


Read the Web Server Role (IIS) information. Then choose Next.


For Select role services, accept the defaults or change the settings as preferred. Then choose Next.


For Confirmation, read the confirmation information. Then choose Install.


After the installation is complete, choose Close.


After you complete these steps, go to Step 2: Create a Certificate Signing Request (CSR) and Certificate.