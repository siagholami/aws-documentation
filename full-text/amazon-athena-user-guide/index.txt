Amazon Athena User Guide

*Copyright Â© 2020 Amazon Web Services, Inc. and/or its affiliates. All rights reserved.***

Amazon's trademarks and trade dress may not be used in 
     connection with any product or service that is not Amazon's, 
     in any manner that is likely to cause confusion among customers, 
     or in any manner that disparages or discredits Amazon. All other 
     trademarks not owned by Amazon are the property of their respective
     owners, who may or may not be affiliated with, connected to, or 
     sponsored by Amazon.

Contents

What is Amazon Athena?
When should I use Athena?
Accessing Athena
Understanding Tables, Databases, and the Data Catalog
AWS Service Integrations with Athena
Setting Up
Getting Started
Accessing Amazon Athena
Connecting to Data Sources
Integration with AWS Glue
Using AWS Glue to Connect to Data Sources in Amazon S3
Best Practices When Using Athena with AWS Glue
Upgrading to the AWS Glue Data Catalog Step-by-Step
FAQ: Upgrading to the AWS Glue Data Catalog


Using Athena Data Connector for External Hive Metastore
Connecting Athena to an Apache Hive Metastore
Using the AWS Serverless Application Repository to Deploy a Hive Data Source Connector
Using a Default Catalog in External Hive Metastore Queries
Using the AWS CLI with Hive Metastores
Reference Implementation


Using Amazon Athena Federated Query (Preview)
Deploying a Connector and Connecting to a Data Source
Using the AWS Serverless Application Repository to Deploy a Data Source Connector
Using Athena Data Source Connectors
Athena AWS CMDB Connector
Amazon Athena CloudWatch Connector
Amazon Athena CloudWatch Metrics Connector
Amazon Athena DocumentDB Connector
Amazon Athena DynamoDB Connector
Amazon Athena Elasticsearch Connector
Amazon Athena HBase Connector
Amazon Athena Connector for JDBC-Compliant Data Sources
Amazon Athena Redis Connector
Amazon Athena TPC Benchmark DS (TPC-DS) Connector


Writing Federated Queries
Writing a Data Source Connector Using the Athena Query Federation SDK


IAM Policies for Accessing Data Catalogs
Data Catalog Example Policies


Managing Data Sources
Connecting to Amazon Athena with ODBC and JDBC Drivers
Using Athena with the JDBC Driver
Connecting to Amazon Athena with ODBC


Creating Databases and Tables
Creating Databases in Athena
Creating Tables in Athena
Names for Tables, Databases, and Columns
Reserved Keywords
Table Location in Amazon S3
Columnar Storage Formats
Converting to Columnar Formats
Partitioning Data
Partition Projection with Amazon Athena
Setting up Partition Projection
Supported Types for Partition Projection
Dynamic ID Partitioning
Amazon Kinesis Data Firehose Example


Running SQL Queries Using Amazon Athena
Working with Query Results, Output Files, and Query History
Working with Views
Creating a Table from Query Results (CTAS)
Considerations and Limitations for CTAS Queries
Running CTAS Queries in the Console
Bucketing vs Partitioning
Examples of CTAS Queries
Using CTAS and INSERT INTO for ETL and Data Analysis
Using CTAS and INSERT INTO to Create a Table with More Than 100 Partitions


Handling Schema Updates
Types of Updates
Updates in Tables with Partitions


Querying Arrays
Creating Arrays
Concatenating Strings and Arrays
Converting Array Data Types
Finding Lengths
Accessing Array Elements
Flattening Nested Arrays
Creating Arrays from Subqueries
Filtering Arrays
Sorting Arrays
Using Aggregation Functions with Arrays
Converting Arrays to Strings
Using Arrays to Create Maps
Querying Arrays with Complex Types and Nested Structures


Querying Geospatial Data
What is a Geospatial Query?
Input Data Formats and Geometry Data Types
List of Supported Geospatial Functions
Examples: Geospatial Queries


Using Athena to Query Apache Hudi Datasets
Querying JSON
Best Practices for Reading JSON Data
Extracting Data from JSON
Searching for Values in JSON Arrays
Obtaining Length and Size of JSON Arrays
Troubleshooting JSON Queries


Using Machine Learning (ML) with Amazon Athena (Preview)
Querying with User Defined Functions (Preview)
Querying AWS Service Logs
Querying Application Load Balancer Logs
Querying Classic Load Balancer Logs
Querying Amazon CloudFront Logs
Querying AWS CloudTrail Logs
Querying Amazon EMR Logs
Querying AWS Global Accelerator Flow Logs
Querying Amazon GuardDuty Findings
Querying Network Load Balancer Logs
Querying Amazon VPC Flow Logs
Querying AWS WAF Logs


Querying AWS Glue Data Catalog
Querying Web Server Logs Stored in Amazon S3
Querying Apache Logs Stored in Amazon S3
Querying Internet Information Server (IIS) Logs Stored in Amazon S3


Amazon Athena Security
Data Protection in Athena
Encryption at Rest
Encrypting Query Results Stored in Amazon S3
Creating Tables Based on Encrypted Datasets in Amazon S3


Encryption in Transit
Key Management
Internetwork Traffic Privacy


Identity and Access Management in Athena
Managed Policies for User Access
AmazonAthenaFullAccess Managed Policy
AWSQuicksightAthenaAccess Managed Policy


Access through JDBC and ODBC Connections
Access to Amazon S3
Fine-Grained Access to Databases and Tables in the AWS Glue Data Catalog
Access to Encrypted Metadata in the AWS Glue Data Catalog
Cross-account Access in Athena to Amazon S3 Buckets
Access to Workgroups and Tags
Allow Access to an Athena Data Connector for External Hive Metastore
Allow Lambda Function Access to External Hive Metastores
Example IAM Permissions Policies to Allow Athena Federated Query (Preview)
Example IAM Permissions Policies to Allow Amazon Athena User Defined Functions (UDF)
Allowing Access for ML with Athena (Preview)
Enabling Federated Access to the Athena API


Logging and Monitoring in Athena
Compliance Validation for Amazon Athena
Resilience in Athena
Infrastructure Security in Athena
Connect to Amazon Athena Using an Interface VPC Endpoint


Configuration and Vulnerability Analysis in Athena
Using Athena to Query Data Registered With AWS Lake Formation
How Athena Accesses Data Registered With Lake Formation
Considerations and Limitations When Using Athena to Query Data Registered With Lake Formation
Managing Lake Formation and Athena User Permissions
Applying Lake Formation Permissions to Existing Databases and Tables


Using Workgroups to Control Query Access and Costs
Using Workgroups for Running Queries
Benefits of Using Workgroups
How Workgroups Work
Setting up Workgroups
IAM Policies for Accessing Workgroups
Workgroup Example Policies


Workgroup Settings
Workgroup Settings Override Client-Side Settings


Managing Workgroups
Athena Workgroup APIs
Troubleshooting Workgroups


Controlling Costs and Monitoring Queries with CloudWatch Metrics and Events
Enabling CloudWatch Query Metrics
Monitoring Athena Queries with CloudWatch Metrics
Monitoring Athena Queries with CloudWatch Events
Setting Data Usage Control Limits


Tagging Resources
Working with Tags on Workgroups in the Console
Using Tag Operations
Tag-Based IAM Access Control Policies
Monitoring Logs and Troubleshooting
Logging Amazon Athena API Calls with AWS CloudTrail
Troubleshooting
SerDe Reference
Using a SerDe
Supported SerDes and Data Formats
Avro SerDe
Regex SerDe
CloudTrail SerDe
OpenCSVSerDe for Processing CSV
Grok SerDe
JSON SerDe Libraries
LazySimpleSerDe for CSV, TSV, and Custom-Delimited Files
ORC SerDe
Parquet SerDe


Compression Formats
SQL Reference for Amazon Athena
Data Types in Amazon Athena
DML Queries, Functions, and Operators
SELECT
INSERT INTO
Presto Functions in Amazon Athena


DDL Statements
Unsupported DDL
ALTER DATABASE SET DBPROPERTIES
ALTER TABLE ADD COLUMNS
ALTER TABLE ADD PARTITION
ALTER TABLE DROP PARTITION
ALTER TABLE RENAME PARTITION
ALTER TABLE SET LOCATION
ALTER TABLE SET TBLPROPERTIES
CREATE DATABASE
CREATE TABLE
CREATE TABLE AS
CREATE VIEW
DESCRIBE TABLE
DESCRIBE VIEW
DROP DATABASE
DROP TABLE
DROP VIEW
MSCK REPAIR TABLE
SHOW COLUMNS
SHOW CREATE TABLE
SHOW CREATE VIEW
SHOW DATABASES
SHOW PARTITIONS
SHOW TABLES
SHOW TBLPROPERTIES
SHOW VIEWS


Considerations and Limitations for SQL Queries in Amazon Athena
Code Samples, Service Quotas, and Previous JDBC Driver
Code Samples
Using Earlier Version JDBC Drivers
Service Quotas
Release Notes
July 29, 2020
July 9, 2020
June 1, 2020
May 21, 2020
April 1, 2020
March 11, 2020
March 6, 2020
November 26, 2019
November 12, 2019
November 8, 2019
October 8, 2019
September 19, 2019
September 12, 2019
August 16, 2019
August 9, 2019
June 26, 2019
May 24, 2019
March 05, 2019
February 22, 2019
February 18, 2019
November 20, 2018
October 15, 2018
October 10, 2018
September 6, 2018
August 23, 2018
August 16, 2018
August 7, 2018
June 5, 2018
May 17, 2018
April 19, 2018
April 6, 2018
March 15, 2018
February 2, 2018
January 19, 2018
November 13, 2017
November 1, 2017
October 19, 2017
October 3, 2017
September 25, 2017
August 14, 2017
August 4, 2017
June 22, 2017
June 8, 2017
May 19, 2017
April 4, 2017
March 24, 2017
February 20, 2017
Document History
AWS Glossary
