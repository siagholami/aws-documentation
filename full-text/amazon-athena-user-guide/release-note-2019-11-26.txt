November 26, 2019
Published on 2019-12-17
Amazon Athena adds support for running SQL queries across relational, non-relational, object, and custom data sources, invoking machine learning models in SQL queries, User Defined Functions (UDFs) (Preview), using Apache Hive Metastore as a metadata catalog with Amazon Athena (Preview), and four additional query-related metrics.
Federated SQL Queries
Use Federated SQL queries to run SQL queries across relational, non-relational, object, and custom data sources.
You can now use Athena’s federated query to scan data stored in relational, non-relational, object, and custom data sources. With federated querying, you can submit a single SQL query that scans data from multiple sources running on premises or hosted in the cloud.
Running analytics on data spread across applications can be complex and time consuming for the following reasons:
 Data required for analytics is often spread across relational, key-value, document, in-memory, search, graph, object, time-series and ledger data stores.
 To analyze data across these sources, analysts build complex pipelines to extract, transform, and load into a data warehouse so that the data can be queried.
 Accessing data from various sources requires learning new programming languages and data access constructs.
Federated SQL queries in Athena eliminate this complexity by allowing users to query the data in-place from wherever it resides. Analysts can use familiar SQL constructs to JOIN data across multiple data sources for quick analysis, and store results in Amazon S3 for subsequent use.
Data Source Connectors
Athena processes federated queries using Athena Data Source Connectors that run on AWS Lambda. Use these open sourced data source connectors to run federated SQL queries in Athena across Amazon DynamoDB, Apache HBase, Amazon Document DB, Amazon Redshift, Amazon CloudWatch, Amazon CloudWatch Metrics, and JDBC-compliant relational databases such MySQL, and PostgreSQL under the Apache 2.0 license.
Custom Data Source Connectors
Using Athena Query Federation SDK, developers can build connectors to any data source to enable Athena to run SQL queries against that data source. Athena Query Federation Connector extends the benefits of federated querying beyond AWS provided connectors. Because connectors run on AWS Lambda, you do not have to manage infrastructure or plan for scaling to peak demands.
Preview Availability
Athena federated query is available in preview in the US East (N. Virginia) Region.
Next Steps

To begin your preview, follow the instructions in the Athena Preview Features FAQ.
To learn more about the federated query feature, see Using Amazon Athena Federated Query (Preview).
To get started with using an existing connector, see Deploying a Connector and Connecting to a Data Source.
To learn how to build your own data source connector using the Athena Query Federation SDK, see Example Athena Connector on GitHub.

Invoking Machine Learning Models in SQL Queries
You can now invoke machine learning models for inference directly from your Athena queries. The ability to use machine learning models in SQL queries makes complex tasks such anomaly detection, customer cohort analysis, and sales predictions as simple as invoking a function in a SQL query.
ML Models
You can use more than a dozen built-in machine learning algorithms provided by Amazon SageMaker, train your own models, or find and subscribe to model packages from AWS Marketplace and deploy on Amazon SageMaker Hosting Services. There is no additional setup required. You can invoke these ML models in your SQL queries from the Athena console, Athena APIs, and through Athena’s preview JDBC driver.
Preview Availability
Athena’s ML functionality is available today in preview in the US East (N. Virginia) Region.
Next Steps

To begin your preview, follow the instructions in the Athena Preview Features FAQ.
To learn more about the machine learning feature, see Using Machine Learning (ML) with Amazon Athena (Preview).

User Defined Functions (UDFs) (Preview)
You can now write custom scalar functions and invoke them in your Athena queries. You can write your UDFs in Java using the Athena Query Federation SDK. When a UDF is used in a SQL query submitted to Athena, it is invoked and run on AWS Lambda. UDFs can be used in both SELECT and FILTER clauses of a SQL query. You can invoke multiple UDFs in the same query.
Preview Availability
Athena UDF functionality is available in Preview mode in the US East (N. Virginia) Region.
Next Steps

To begin your preview, follow the instructions in the Athena Preview Features FAQ.
To learn more, see Querying with User Defined Functions (Preview).
For example UDF implementations, see Amazon Athena UDF Connector on GitHub.
To learn how to write your own functions using the Athena Query Federation SDK, see Creating and Deploying a UDF Using Lambda.

Using Apache Hive Metastore as a Metacatalog with Amazon Athena (Preview)
You can now connect Athena to one or more Apache Hive Metastores in addition to the AWS Glue Data Catalog with Athena.
Metastore Connector
To connect to a self-hosted Hive Metastore, you need an Athena Hive Metastore connector. Athena provides a reference implementation connector that you can use. The connector runs as an AWS Lambda function in your account. For more information, see Using Athena Data Connector for External Hive Metastore (Preview).
Preview Availability
The Hive Metastore feature is available in Preview mode in the US East (N. Virginia) Region.
Next Steps

To begin your preview, follow the instructions in the Athena Preview Features FAQ.
To learn more about this feature, please visit our Using Athena Data Connector for External Hive Metastore (Preview).

New Query-Related Metrics
Athena now publishes additional query metrics that can help you understand Amazon Athena performance. Athena publishes query-related metrics to Amazon CloudWatch. In this release, Athena publishes the following additional query metrics:
 Query Planning Time – The time taken to plan the query. This includes the time spent retrieving table partitions from the data source.
 Query Queuing Time – The time that the query was in a queue waiting for resources.
 Service Processing Time – The time taken to write results after the query engine finishes processing.
 Total Execution Time – The time Athena took to run the query.
To consume these new query metrics, you can create custom dashboards, set alarms and triggers on metrics in CloudWatch, or use pre-populated dashboards directly from the Athena console. 
Next Steps
For more information, see Monitoring Athena Queries with CloudWatch Metrics.