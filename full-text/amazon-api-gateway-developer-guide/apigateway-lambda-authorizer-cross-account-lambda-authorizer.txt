Configure a cross-account Lambda authorizer
You can now also use an AWS Lambda function from a different AWS account as your API authorizer function. Each account can be in any region where Amazon API Gateway is available. The Lambda authorizer function can use bearer token authentication strategies such as OAuth or SAML. This makes it easy to centrally manage and share a central Lambda authorizer function across multiple API Gateway APIs.
In this section, we show how to configure a cross-account Lambda authorizer function using the Amazon API Gateway console.
These instructions assume that you already have an API Gateway API in one AWS account and a Lambda authorizer function in another account.
Configure a cross-account Lambda authorizer using the API Gateway console
Log in to the Amazon API Gateway console in your first account (the one that has your API in it) and do the following:


Locate your API and choose Authorizers.


Choose Create New Authorizer. 


For Create Authorizer, type an authorizer name in the Name input field. 


For Type, choose the Lambda option. 


For Lambda Function, copy-paste the full ARN for the Lambda authorizer function that you have in your second account.
Note
In the Lambda console, you can find the ARN for your function in the upper right corner of the console window.


Leave Lambda Invoke Role blank to let the API Gateway console set a resource-based policy. The policy grants API Gateway permissions to invoke the authorizer Lambda function. You can also choose to type the name of an IAM role to allow API Gateway to invoke the authorizer Lambda function. For an example of such a role, see Create an assumable IAM role. 
If you choose to let the API Gateway console set the resource-based policy, the Add Permission to Lambda Function dialog is displayed. Choose OK. After the Lambda authorization is created, you can test it with appropriate authorization token values to verify that it works as expected. 


For Lambda Event Payload, choose either Token for a TOKEN authorizer or Request for a REQUEST authorizer.


Depending on the choice you made in the previous step, do one of the following:


For the Token options, do the following: 


Type the name of a header in Token Source. The API client must include a header of this name to send the authorization token to the Lambda authorizer. 


Optionally, provide a RegEx statement in Token Validation input field. API Gateway performs initial validation of the input token against this expression and invokes the authorizer upon successful validation. This helps reduce chances of being charged for invalid tokens.


For Authorization Caching, select or clear the Enabled option, depending on whether you want to cache the authorization policy generated by the authorizer or not. When policy caching is enabled, you can choose to modify the TTL value from the default (300). Setting TTL=0 disables policy caching. When policy caching is enabled, the header name specified in Token Source becomes the cache key.




For the Request option, do the following:


For Identity Sources, type a request parameter name of a chosen parameter type. Supported parameter types are Header, Query String, Stage Variable, and Context. To add more identity sources, choose Add Identity Source. 
API Gateway uses the specified identity sources as the request authorizer caching key. When caching is enabled, API Gateway calls the authorizer's Lambda function only after successfully verifying that all the specified identity sources are present at runtime. If a specified identify source is missing, null, or empty, API Gateway returns a 401 Unauthorized response without calling the authorizer Lambda function. 
When multiple identity sources are defined, they are all used to derive the authorizer's cache key. Changing any of the cache key parts causes the authorizer to discard the cached policy document and generate a new one.


For Authorization Caching, leave the Enabled option selected. Leave the TTL value set to the default (300).




Choose Create to create the new Lambda authorizer for the chosen API.


You'll see a popup that says Add Permission to Lambda Function: You have selected a Lambda function from another account. Please ensure that you have the appropriate Function Policy on this function. You can do this by running the following AWS CLI command from account 123456789012:, followed by an aws lambda add-permission command string.


Copy-paste the aws lambda add-permission command string into an AWS CLI window that is configured for your second account. This will grant your first account access to your second account's Lambda authorizer function.


In the popup from the previous step, choose OK.

