Streaming Amazon Chime Voice Connector media to Kinesis
You can stream phone call audio from Amazon Chime Voice Connectors to Amazon Kinesis Video Streams for analytics, machine learning, and other processing. Developers can store and encrypt audio data in Kinesis Video Streams, and access the data using the Kinesis Video Streams API operation. For more information, see the https://docs.aws.amazon.com/kinesisvideostreams/latest/dg/what-is-kinesis-video.html.
Use the Amazon Chime console to start media streaming for your Amazon Chime Voice Connector. When media streaming is started, your Amazon Chime Voice Connector uses an AWS Identity and Access Management (IAM) service-linked role to grant permissions to stream media to Kinesis Video Streams. Then, call audio from each Amazon Chime Voice Connector telephone call leg is streamed in real time to separate Kinesis Video Streams.
Use the Kinesis Video Streams Parser Library to download the media streams sent from your Amazon Chime Voice Connector. Filter the streams by the following persistent fragments metadata:
 TransactionId
 VoiceConnectorId
For more information, see Kinesis Video Streams Parser Library and Using streaming metadata with Kinesis Video Streams in the Amazon Kinesis Video Streams Developer Guide.
For more information about using IAM service-linked roles with Amazon Chime Voice Connectors, see Using roles to stream Amazon Chime Voice Connector media to Kinesis. For more information about using Amazon CloudWatch with Amazon Chime, see Logging and monitoring in Amazon Chime.
When you enable media streaming for your Amazon Chime Voice Connector, Amazon Chime creates an IAM service-linked role called AWSServiceRoleForAmazonChimeVoiceConnector. If you have configured call detail record logging for Amazon Chime Voice Connectors in the Amazon Chime console, streaming detail records are sent to your configured Amazon S3 bucket. For more information, see Amazon Chime Voice Connector streaming detail records.
Starting media streaming
Start media streaming for your Amazon Chime Voice Connector from the Amazon Chime console.
To start media streaming for your Amazon Chime Voice Connector


Open the Amazon Chime console at https://chime.aws.amazon.com/.


For Calling, choose Voice connectors.


Choose the name of the Amazon Chime Voice Connector.


Choose Streaming.


For Sending to Kinesis Video Streams, choose Start.


Select a Data retention period.


Choose Save.


Turn off media streaming from the Amazon Chime console. If you no longer need to use media streaming for any of your Amazon Chime Voice Connectors, we recommend that you also delete the related service-linked role. For more information, see Deleting a service-linked role for Amazon Chime Voice Connectors.
To stop media streaming for your Amazon Chime Voice Connector


Open the Amazon Chime console at https://chime.aws.amazon.com/.


For Calling, choose Voice connectors.


Choose the name of the Amazon Chime Voice Connector.


Choose Streaming.


For Sending to Kinesis Video Streams, choose Stop.


Choose Save.


SIP-based media recording (SIPREC) and network-based recording (NBR) compatibility
You can use an Amazon Chime Voice Connector to stream media to Kinesis Video Streams. You can stream from a SIPREC-compatible voice infrastructure or the NBR feature associated with Cisco Unified Border Element (CUBE).
You must have a Private Branch Exchange (PBX), Session Border Controller (SBC), or contact center that supports the SIPREC protocol or NBR feature. The PBX or SBC must be able to send signaling and media to AWS public IP addresses. For more information, see Before you begin.
To set up streaming of RTP audio streams forked with SIPREC or NBR


Create an Amazon Chime Voice Connector. For more information, see Creating an Amazon Chime Voice Connector.


Start media streaming for your Amazon Chime Voice Connector. For more information, see Starting media streaming.


In the Amazon Chime console, under Voice connectors, view the Outbound host name for your Amazon Chime Voice Connector. For example, abcdef1ghij2klmno3pqr4.voiceconnector.chime.aws.


Do one of the following:
    For SIPREC – Configure your PBX, SBC, or other voice infrastructure to fork RTP streams with SIPREC to the Outbound host name of your Amazon Chime Voice Connector.
    For NBR – Configure your PBX, SBC, or other voice infrastructure to fork RTP streams with NBR to the Outbound host name of your Amazon Chime Voice Connector. Send an additional header or URI parameter of X-Voice-Connector-Record-Only with the value true in the SIP INVITE.

