Prerequisites for running IDT tests
This section describes the prerequisites for using AWS IoT Device Tester (IDT) for AWS IoT Greengrass.
Download the latest version of AWS IoT Device Tester for AWS IoT Greengrass
Download the latest version of IDT from Supported versions of AWS IoT Device Tester for AWS IoT Greengrass. Extract the software into a location on your file system where you have read and write permissions. 
Note
IDT does not support being run by multiple users from a shared location, such as an NFS directory or a Windows network shared folder. Doing so may result in crashes or data corruption. We recommend that you extract the IDT package to a local drive and run the IDT binary on your local workstation.
Windows has a path length limitation of 260 characters. If you are using Windows, extract IDT to a root directory like C:\ or D:\ to keep your paths under the 260 character limit.
Create and configure an AWS account
Before you can use IDT for AWS IoT Greengrass, you must create an AWS account and configure permissions that IDT needs while running tests. The permissions allow IDT to access AWS services and create AWS resources, such as AWS IoT things, Greengrass groups, and Lambda functions, on your behalf.
To create these resources, IDT for AWS IoT Greengrass uses the AWS credentials configured in the config.json file to make API calls on your behalf. These resources are provisioned at various times during a test.
Note
Although most tests qualify for AWS Free Tier, you must provide a credit card when you sign up for an AWS account. For more information, see  Why do I need a payment method if my account is covered by the Free Tier?.
Step 1: Create an AWS account
In this step, create and configure an AWS account. If you already have an AWS account, skip to Step 2: Configure permissions for IDT.


Open the AWS home page, and choose Create an AWS Account.
Note
If you've signed in to AWS recently, you might see Sign In to the Console instead.


Follow the online instructions. Part of the sign-up procedure includes registering a credit card, receiving a text message or phone call, and entering a PIN.


For more information, see How do I create and activate a new Amazon Web Services account?
Step 2: Configure permissions for IDT
In this step, configure the permissions that IDT for AWS IoT Greengrass uses to run tests and collect IDT usage data. You can use the AWS Management Console or AWS Command Line Interface (AWS CLI) to create an IAM policy and a test user for IDT, and then attach policies to the user. If you already created a test user for IDT, skip to Configuring your device or Optional: Configuring your Docker container for IDT for AWS IoT Greengrass.
 To Configure Permissions for IDT (Console)
 To Configure Permissions for IDT (AWS CLI)
To configure permissions for IDT (console)
Follow these steps to use the console to configure permissions for IDT for AWS IoT Greengrass.


Sign in to the IAM console.


Create a customer managed policy that grants permissions to create roles with specific permissions. 


In the navigation pane, choose Policies, and then choose Create policy.


On the JSON tab, replace the placeholder content with the following policy.
<a name="customer-managed-policy-cli"></a>{
      "Version": "2012-10-17",
      "Statement": [
          {
              "Sid": "ManageRolePoliciesForIDTGreengrass",
              "Effect": "Allow",
              "Action": [
                  "iam:DetachRolePolicy",
                  "iam:AttachRolePolicy"
              ],
              "Resource": [
                  "arn:aws:iam::*:role/idt-*",
                  "arn:aws:iam::*:role/GreengrassServiceRole"
              ],
              "Condition": {
                  "ArnEquals": {
                      "iam:PolicyARN": [
                          "arn:aws:iam::aws:policy/service-role/AWSGreengrassResourceAccessRolePolicy",
                          "arn:aws:iam::aws:policy/service-role/GreengrassOTAUpdateArtifactAccess",
                          "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                      ]
                  }
              }
          },
          {
              "Sid": "ManageRolesForIDTGreengrass",
              "Effect": "Allow",
              "Action": [
                  "iam:CreateRole",
                  "iam:DeleteRole",
                  "iam:PassRole",
                  "iam:GetRole"
              ],
              "Resource": [
                  "arn:aws:iam::*:role/idt-*",
                  "arn:aws:iam::*:role/GreengrassServiceRole"
              ]
          }
      ]
  }
Important 
The following policy grants permission to create and manage roles required by IDT for AWS IoT Greengrass. This includes permissions to attach the following AWS managed policies:
AWSGreengrassResourceAccessRolePolicy
GreengrassOTAUpdateArtifactAccess
AWSLambdaBasicExecutionRole


Choose Review policy.


For Name, enter IDTGreengrassIAMPermissions. Under Summary, review the permissions granted by your policy.


Choose Create policy.


Create an IAM user and attach the permissions required by IDT for AWS IoT Greengrass.


Create an IAM user. Follow steps 1 through 5 in Creating IAM users (console) in the IAM User Guide.


Attach the permissions to your IAM user:


On the Set permissions  page, choose Attach existing policies to user directly.


Search for the IDTGreengrassIAMPermissions policy that you created in the previous step. Select the check box.


Search for the AWSIoTDeviceTesterForGreengrassFullAccess policy. Select the check box.
Note 
The AWSIoTDeviceTesterForGreengrassFullAccess is an AWS managed policy that defines the permissions IDT requires to create and access AWS resources used for testing. For more information, see AWS managed policy for AWS IoT Device Tester.




Choose Next: Tags.


Choose Next: Review to view a summary of your choices.


Choose Create user.


To view the user's access keys (access key IDs and secret access keys), choose Show next to the password and access key. To save the access keys, choose Download.csv and save the file to a secure location. You use this information later to configure your AWS credentials file.


Next step: Configure your physical device.



To configure permissions for IDT (AWS CLI)
Follow these steps to use the AWS CLI to configure permissions for IDT for AWS IoT Greengrass. If you already configured permissions in the console, skip to Configuring your device or Optional: Configuring your Docker container for IDT for AWS IoT Greengrass.


On your computer, install and configure the AWS CLI if it's not already installed. Follow the steps in  Installing the AWS CLI in the AWS Command Line Interface User Guide.
Note
The AWS CLI is an open source tool that you can use to interact with AWS services from your command-line shell.


Create a customer managed policy that grants permissions to manage IDT and AWS IoT Greengrass roles.



[ Linux, macOS, or Unix ]
aws iam create-policy --policy-name IDTGreengrassIAMPermissions --policy-document '<a name="customer-managed-policy-cli"></a>{
       "Version": "2012-10-17",
       "Statement": [
           {
               "Sid": "ManageRolePoliciesForIDTGreengrass",
               "Effect": "Allow",
               "Action": [
                   "iam:DetachRolePolicy",
                   "iam:AttachRolePolicy"
               ],
               "Resource": [
                   "arn:aws:iam::*:role/idt-*",
                   "arn:aws:iam::*:role/GreengrassServiceRole"
               ],
               "Condition": {
                   "ArnEquals": {
                       "iam:PolicyARN": [
                           "arn:aws:iam::aws:policy/service-role/AWSGreengrassResourceAccessRolePolicy",
                           "arn:aws:iam::aws:policy/service-role/GreengrassOTAUpdateArtifactAccess",
                           "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                       ]
                   }
               }
           },
           {
               "Sid": "ManageRolesForIDTGreengrass",
               "Effect": "Allow",
               "Action": [
                   "iam:CreateRole",
                   "iam:DeleteRole",
                   "iam:PassRole",
                   "iam:GetRole"
               ],
               "Resource": [
                   "arn:aws:iam::*:role/idt-*",
                   "arn:aws:iam::*:role/GreengrassServiceRole"
               ]
           }
       ]
   }'

[ Windows command prompt ]
aws iam create-policy --policy-name IDTGreengrassIAMPermissions --policy-document '{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"ManageRolePoliciesForIDTGreengrass\",\"Effect\": \"Allow\",\"Action\": [\"iam:DetachRolePolicy\", \"iam:AttachRolePolicy\"], \"Resource\": [\"arn:aws:iam::*:role/idt-*\",\"arn:aws:iam::*:role/GreengrassServiceRole\"],\"Condition\": {\"ArnEquals\": {\"iam:PolicyARN\": [\"arn:aws:iam::aws:policy/service-role/AWSGreengrassResourceAccessRolePolicy\",\"arn:aws:iam::aws:policy/service-role/GreengrassOTAUpdateArtifactAccess\",\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\"]}}},{\"Sid\": \"ManageRolesForIDTGreengrass\",\"Effect\": \"Allow\",\"Action\": [\"iam:CreateRole\",\"iam:DeleteRole\", \"iam:PassRole\", \"iam:GetRole\"],\"Resource\": [\"arn:aws:iam::*:role/idt-*\",\"arn:aws:iam::*:role/GreengrassServiceRole\"]}]}'
Note
This step includes a Windows command prompt example because it uses a different JSON syntax than Linux, macOS, or Unix terminal commands.



Create an IAM user and attach the permissions required by IDT for AWS IoT Greengrass.


Create an IAM user. In this example setup, the user is named IDTGreengrassUser.
aws iam create-user --user-name IDTGreengrassUser


Attach the IDTGreengrassIAMPermissions policy you created in step 2 to your IAM user. Replace  in the command with the ID of your AWS account.
aws iam attach-user-policy --user-name IDTGreengrassUser --policy-arn arn:aws:iam::<account-id>:policy/IDTGreengrassIAMPermissions


Attach the AWSIoTDeviceTesterForGreengrassFullAccess policy to your IAM user.
aws iam attach-user-policy --user-name IDTGreengrassUser --policy-arn arn:aws:iam::aws:policy/AWSIoTDeviceTesterForGreengrassFullAccess
Note 
The AWSIoTDeviceTesterForGreengrassFullAccess is an AWS managed policy that defines the permissions IDT requires to create and access AWS resources used for testing. For more information, see AWS managed policy for AWS IoT Device Tester.


Create a secret access key for the user.


aws iam create-access-key --user-name IDTGreengrassUser
Store the output in a secure location. You use this information later to configure your AWS credentials file.

Next step: Configure your physical device.

AWS managed policy for AWS IoT Device Tester
The AWSIoTDeviceTesterForGreengrassFullAccess managed policy allows IDT to run operations and collect usage metrics. This policy grants the following IDT permissions:
 iot-device-tester:CheckVersion. Check whether a set of AWS IoT Greengrass, test suite, and IDT versions are compatible.
 iot-device-tester:DownloadTestSuite. Download test suites.
 iot-device-tester:LatestIdt. Get information about the latest IDT version that is available for download.
 iot-device-tester:SendMetrics. Publish usage data that IDT collects about your tests.
 iot-device-tester:SupportedVersion. Get the list of AWS IoT Greengrass and test suite versions that are supported by IDT. This information is displayed in the command-line window.