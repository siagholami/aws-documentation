Configure devices and subscriptions
Shadows can be synced to AWS IoT when the AWS IoT Greengrass core is connected to the internet. In this module, you first use local shadows without syncing to the cloud. Then, you enable cloud syncing.
Each device has its own shadow. For more information, see Device shadow service for AWS IoT in the AWS IoT Developer Guide.

From the Devices page, add two new devices in your AWS IoT Greengrass group. For detailed steps of this process, see Create AWS IoT devices in an AWS IoT Greengrass group.
    Name the devices GG_Switch and GG_TrafficLight.
    Generate and download the 1-Click default security resources for both devices.
    Make a note of the hash component in the file names of the security resources for the devices. You use these values later.



Decompress the downloaded certificates and keys for both devices into a single folder on your computer. For example, run the following command for each .tar.gz file.

tar -xzf hash-setup.tar.gz
Note
On Windows, you can decompress .tar.gz files using a tool such as 7-Zip or WinZip.


Copy the root-ca-cert.pem file that you downloaded in the previous module to this folder.


Make sure that the devices are set to use local shadows. If not, choose the ellipsis (â€¦), and then choose Make local only.



The function code used in this module requires that you manually configure the core's endpoint.


On the group configuration page, choose Settings. 


For Local connection detection, choose Manually manage connection information, and then choose View Cores for specific endpoint information.


Choose your core, and then choose Connectivity.


Choose Edit and make sure that you have only one endpoint value. This value must be the IP address endpoint for port 8883 of your AWS IoT Greengrass core device (for example, 192.168.1.4).


Choose Update.


Add the subscriptions in the following table to your group. For example, to create the first subscription:


On the group configuration page, choose Subscriptions, and then choose Add subscription.


Under Select a source, choose Devices, and then choose GG_Switch.


Under Select a target, choose Services, and then choose Local Shadow Service.


Choose Next.


For Topic filter, enter $aws/things/GG_TrafficLight/shadow/update


Choose Next, and then choose Finish.


The topics must be entered exactly as shown in the table. Although it's possible to use wildcards to consolidate some of the subscriptions, we don't recommend this practice. For more information, see Shadow MQTT topics in the AWS IoT Developer Guide.  
[See the AWS documentation website for more details]
The new subscriptions are displayed on the Subscriptions page. To see the full topic path of a subscription, hover your mouse over the Topic column.

Note
For information about the $ character, see Reserved topics.


Make sure that automatic detection is enabled so the Greengrass core can publish a list of its IP addresses. Devices use this information to discover the core.


On the group configuration page, choose Settings.


Under Core connectivity information, for Local connection detection, choose Automatically detect and override connection information.


Make sure that the Greengrass daemon is running, as described in Deploy cloud configurations to a core device.


On the group configuration page, from Actions, choose Deploy.



This deploys the group configuration to your AWS IoT Greengrass core device. For troubleshooting help, see Troubleshooting AWS IoT Greengrass.